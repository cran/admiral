<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Creating a BDS Exposure ADaM</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Creating a BDS Exposure ADaM</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This article describes creating an Exposure ADaM using the BDS structure. Examples are currently presented using an underlying <code>EX</code> domain where the <code>EX</code> domain represents data as collected on the CRF and the <code>ADEX</code> ADaM is output. However, the examples can be applied to situations where an <code>EC</code> domain is used as input and/or <code>ADEC</code> or another exposure ADaM is created.</p>
<p>There are many different approaches to modeling exposure data. This vignette gives examples of creating <code>PARAMCD</code> and <code>AVAL</code> combinations using exposure data. This vignette is not meant to be a guide or standard for the structure of exposure analysis datasets.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM format as input unless otherwise specified.</em></p>
</div>
<div id="programming-workflow" class="section level1">
<h1>Programming Workflow</h1>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#datetime">Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</a></li>
<li><a href="#duration">Compute Duration for a Record</a></li>
<li><a href="#onetoone">Create 1:1 Mapping Records</a></li>
<li><a href="#summaryrec">Create Summary Records</a></li>
<li><a href="#paramcd">Assign <code>PARAMCD</code>, <code>PARAMN</code>, etc. from Reference Tables</a></li>
<li><a href="#cat">Derive Categorization Variables (<code>AVALCATx</code>)</a></li>
<li><a href="#aseq">Assign <code>ASEQ</code></a></li>
<li><a href="#adsl_vars">Add ADSL variables <code>ASEQ</code></a></li>
<li><a href="#attributes">Add Labels and Attributes</a></li>
</ul>
<div id="readdata" class="section level2">
<h2>Read in Data</h2>
<p>To start, all data frames needed for the creation of <code>ADEX</code> should be read into the environment. This will be a company specific process. Some of the data frames needed may be <code>EX</code> and <code>ADSL</code>.</p>
<p>For example purpose, the CDISC Pilot SDTM and ADaM datasets—which are included in <code>{admiral.test}</code>—are used.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(admiral)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(admiral.test)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;admiral_adsl&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;admiral_ex&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> admiral_adsl</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(admiral_ex)</span></code></pre></div>
<p>At this step, it may be useful to join <code>ADSL</code> to your <code>EX</code> domain as well. Only the <code>ADSL</code> variables used for derivations are selected at this step. The rest of the relevant <code>ADSL</code> variables would be added later.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>adsl_vars <span class="ot">&lt;-</span> <span class="fu">exprs</span>(TRTSDT, TRTSDTM, TRTEDT, TRTEDTM)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_merged</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ex,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_add =</span> adsl,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_vars =</span> adsl_vars,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<colgroup>
<col width="11%" />
<col width="10%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">EXTRT</th>
<th align="right">EXDOSE</th>
<th align="left">EXDOSFRQ</th>
<th align="left">VISIT</th>
<th align="left">EXSTDTC</th>
<th align="left">EXENDTC</th>
<th align="left">TRTSDTM</th>
<th align="left">TRTEDTM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02 23:59:59</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02 23:59:59</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02 23:59:59</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01 23:59:59</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01 23:59:59</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">XANOMELINE</td>
<td align="right">54</td>
<td align="left">QD</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04 23:59:59</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">XANOMELINE</td>
<td align="right">54</td>
<td align="left">QD</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04 23:59:59</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
<td align="left">2013-01-25</td>
<td align="left">2013-03-16 23:59:59</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">PLACEBO</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
<td align="left">2013-01-25</td>
<td align="left">2013-03-16 23:59:59</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">XANOMELINE</td>
<td align="right">54</td>
<td align="left">QD</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24 23:59:59</td>
</tr>
</tbody>
</table>
<p>The CDISC pilot <code>EX</code> domain data does not contain a dose adjustment flag or the planned dose information. For demonstration purposes, this will be added to the data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">EXADJ =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      USUBJID <span class="sc">==</span> <span class="st">&quot;01-701-1028&quot;</span> <span class="sc">&amp;</span> VISIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WEEK 2&quot;</span>) <span class="sc">~</span> <span class="st">&quot;ADVERSE EVENT&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      USUBJID <span class="sc">==</span> <span class="st">&quot;01-701-1148&quot;</span> <span class="sc">&amp;</span> VISIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WEEK 2&quot;</span>, <span class="st">&quot;WEEK 24&quot;</span>) <span class="sc">~</span> <span class="st">&quot;MEDICATION ERROR&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">EXDOSE =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      USUBJID <span class="sc">==</span> <span class="st">&quot;01-701-1028&quot;</span> <span class="sc">&amp;</span> VISIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WEEK 2&quot;</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      USUBJID <span class="sc">==</span> <span class="st">&quot;01-701-1148&quot;</span> <span class="sc">&amp;</span> VISIT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WEEK 2&quot;</span>, <span class="st">&quot;WEEK 24&quot;</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> EXDOSE</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXPLDOS =</span> <span class="fu">if_else</span>(EXTRT <span class="sc">==</span> <span class="st">&quot;PLACEBO&quot;</span>, <span class="dv">0</span>, <span class="dv">54</span>))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(adex, EXTRT, EXPLDOS)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   EXTRT      EXPLDOS</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 PLACEBO          0</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 XANOMELINE      54</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(adex, EXADJ)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   EXADJ     n</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;NA&gt;     13</span></span></code></pre></div>
</div>
<div id="datetime" class="section level2">
<h2>Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</h2>
<p>The function <code>derive_vars_dt()</code> can be used to derive <code>ADT</code>. This function allows the user to impute the date as well.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_dt</span>(adex, <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>, <span class="at">dtc =</span> EXSTDTC)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_dt</span>(adex, <span class="at">new_vars_prefix =</span> <span class="st">&quot;AEN&quot;</span>, <span class="at">dtc =</span> EXENDTC)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">EXSTDTC</th>
<th align="left">EXENDTC</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
</tr>
</tbody>
</table>
<p>The next examples demonstrates the datetime imputation features available in the <code>derive_vars_dtm()</code> function, where the time is imputed as “00:00:00”:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  adex,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dtc =</span> EXSTDTC,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  adex,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dtc =</span> EXENDTC,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_vars_prefix =</span> <span class="st">&quot;AEN&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">EXSTDTC</th>
<th align="left">EXENDTC</th>
<th align="left">ASTDTM</th>
<th align="left">AENDTM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
</tr>
</tbody>
</table>
<p>The example above imputes the start date to the first first day of the month and imputes the end date to the last day of the month.</p>
<p>Please see the <a href="imputation.Rmd">Date and Time Imputation</a> for additional examples on calculating and imputing analysis dates.</p>
<p>Next, the analysis study days can be derived:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">derive_vars_dy</span>(adex,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference_date =</span> TRTSDT,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_vars =</span> <span class="fu">exprs</span>(ASTDT, AENDT)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ASTDT</th>
<th align="right">ASTDY</th>
<th align="left">AENDT</th>
<th align="right">AENDY</th>
<th align="left">TRTSDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="right">1</td>
<td align="left">2014-01-16</td>
<td align="right">15</td>
<td align="left">2014-01-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="right">16</td>
<td align="left">2014-06-18</td>
<td align="right">168</td>
<td align="left">2014-01-02</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="right">169</td>
<td align="left">2014-07-02</td>
<td align="right">182</td>
<td align="left">2014-01-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="right">1</td>
<td align="left">2012-08-27</td>
<td align="right">23</td>
<td align="left">2012-08-05</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="right">24</td>
<td align="left">2012-09-01</td>
<td align="right">28</td>
<td align="left">2012-08-05</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="right">1</td>
<td align="left">2012-09-16</td>
<td align="right">15</td>
<td align="left">2012-09-02</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="right">16</td>
<td align="left">2012-12-04</td>
<td align="right">94</td>
<td align="left">2012-09-02</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="right">1</td>
<td align="left">2013-02-09</td>
<td align="right">16</td>
<td align="left">2013-01-25</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="right">17</td>
<td align="left">2013-03-16</td>
<td align="right">51</td>
<td align="left">2013-01-25</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="right">1</td>
<td align="left">2013-12-24</td>
<td align="right">5</td>
<td align="left">2013-12-20</td>
</tr>
</tbody>
</table>
</div>
<div id="duration" class="section level2">
<h2>Compute duration for a record</h2>
<p>To compute the duration of treatment or exposure for a record, the <code>derive_vars_duration()</code> function can be used.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">derive_vars_duration</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var =</span> EXDURD,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date =</span> AENDT</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ASTDT</th>
<th align="right">ASTDY</th>
<th align="left">AENDT</th>
<th align="right">AENDY</th>
<th align="right">EXDURD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="right">1</td>
<td align="left">2014-01-16</td>
<td align="right">15</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="right">16</td>
<td align="left">2014-06-18</td>
<td align="right">168</td>
<td align="right">153</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="right">169</td>
<td align="left">2014-07-02</td>
<td align="right">182</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="right">1</td>
<td align="left">2012-08-27</td>
<td align="right">23</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="right">24</td>
<td align="left">2012-09-01</td>
<td align="right">28</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="right">1</td>
<td align="left">2012-09-16</td>
<td align="right">15</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="right">16</td>
<td align="left">2012-12-04</td>
<td align="right">94</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="right">1</td>
<td align="left">2013-02-09</td>
<td align="right">16</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="right">17</td>
<td align="left">2013-03-16</td>
<td align="right">51</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="right">1</td>
<td align="left">2013-12-24</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>The units of the calculated duration can also be changed. In this example, the duration is output as years:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">derive_vars_duration</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var =</span> EXDURDY,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">out_unit =</span> <span class="st">&quot;years&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_date =</span> ASTDT,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date =</span> AENDT</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
<th align="right">EXDURD</th>
<th align="right">EXDURDY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="right">15</td>
<td align="right">0.0410940</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="right">153</td>
<td align="right">0.4191762</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
<td align="right">14</td>
<td align="right">0.0383543</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
<td align="right">23</td>
<td align="right">0.0630118</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
<td align="right">5</td>
<td align="right">0.0136968</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
<td align="right">15</td>
<td align="right">0.0410940</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
<td align="right">79</td>
<td align="right">0.2164365</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
<td align="right">16</td>
<td align="right">0.0438337</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
<td align="right">35</td>
<td align="right">0.0958885</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
<td align="right">5</td>
<td align="right">0.0136968</td>
</tr>
</tbody>
</table>
<p>Please refer to the <code>derive_vars_duration()</code> documentation for detailed information on the input parameters.</p>
<p>It may be necessary to calculate additional intermediate values. For example, the cumulative doses received and cumulative planned doses may be calculated as:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">DOSEO =</span> EXDOSE <span class="sc">*</span> EXDURD,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">PDOSEO =</span> EXPLDOS <span class="sc">*</span> EXDURD</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="right">EXDOSE</th>
<th align="right">EXPLDOS</th>
<th align="right">EXDURD</th>
<th align="right">DOSEO</th>
<th align="right">PDOSEO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">153</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">23</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="right">54</td>
<td align="right">54</td>
<td align="right">15</td>
<td align="right">810</td>
<td align="right">810</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="right">54</td>
<td align="right">54</td>
<td align="right">79</td>
<td align="right">4266</td>
<td align="right">4266</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="right">54</td>
<td align="right">54</td>
<td align="right">5</td>
<td align="right">270</td>
<td align="right">270</td>
</tr>
</tbody>
</table>
<p>It may be of additional interest to turn a single record containing dosing summary information into a set of multiple single records, each representing a single dose over the interval specified by the summary record. This is another approach to deriving a total dose parameter when <code>EXDOSFRQ != ONCE</code>.</p>
<p>The function <code>create_single_dose_dataset()</code> can be used to expand a record containing a start date, an end date, and a dosing frequency to a corresponding set of records each representing one dose (i.e. <code>EXDOSFRQ == &quot;ONCE&quot;</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>single_dose <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(USUBJID <span class="sc">==</span> <span class="st">&quot;01-701-1015&quot;</span> <span class="sc">&amp;</span> EXSTDY <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_single_dose_dataset</span>(<span class="at">keep_source_vars =</span> <span class="fu">exprs</span>(USUBJID, EXDOSE, EXPLDOS, EXDOSFRQ, ASTDT, AENDT))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="right">EXDOSE</th>
<th align="right">EXPLDOS</th>
<th align="left">EXDOSFRQ</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-03</td>
<td align="left">2014-01-03</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-04</td>
<td align="left">2014-01-04</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-05</td>
<td align="left">2014-01-05</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-06</td>
<td align="left">2014-01-06</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-07</td>
<td align="left">2014-01-07</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-08</td>
<td align="left">2014-01-08</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-09</td>
<td align="left">2014-01-09</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-10</td>
<td align="left">2014-01-10</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">ONCE</td>
<td align="left">2014-01-11</td>
<td align="left">2014-01-11</td>
</tr>
</tbody>
</table>
</div>
<div id="onetoone" class="section level2">
<h2>Create 1:1 mapping records</h2>
<p>The first set of exposure records to create will be records mapped 1:1 to an existing collected exposure record in SDTM. For these records, the <code>AVAL</code> or <code>AVALC</code> would be calculated using columns that exist on the data and no summarizing of records would be necessary.</p>
<p>These records may be used for input into summary records or be used individually for summarization in outputs. Some examples may be exposure duration, dose administered, dose adjusted, etc. based on one exposure record in SDTM.</p>
<p>These records can be derived using simple <code>dplyr::mutate</code> assignments and then combined:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>adex_durd <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;DURD&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> EXDURD</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>adex_dose <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;DOSE&quot;</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> DOSEO</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>adex_pldos <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;PLDOSE&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> PDOSEO</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>adex_adj <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ADJ&quot;</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(EXADJ), <span class="st">&quot;Y&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>adex_adjae <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ADJAE&quot;</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">if_else</span>(EXADJ <span class="sc">==</span> <span class="st">&quot;ADVERSE EVENT&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  adex_durd,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  adex_dose,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  adex_pldos,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  adex_adj,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  adex_adjae</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PARCAT1 =</span> <span class="st">&quot;INDIVIDUAL&quot;</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(adex, PARAMCD)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   PARAMCD     n</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ADJ        13</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ADJAE      13</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 DOSE       13</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 DURD       13</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 PLDOSE     13</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">PLDOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">PLDOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">DURD</td>
<td align="right">153</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="summaryrec" class="section level2">
<h2>Create Summary Records</h2>
<p>Exposure is commonly analyzed by a timing interval (e.g. <code>APHASE</code>, <code>APERIOD</code>, <code>AVISIT</code>, etc.). For these types of calculations, the <code>derive_param_exposure()</code> function may be used. In addition to creating a summarized <code>AVAL</code>, the function will also compute minimum and maximum dates for the record.</p>
<p>For example, to calculate the total dose by subject and treatment,</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_param_exposure</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  adex,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_code =</span> <span class="st">&quot;DOSE&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysis_var =</span> AVAL,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TDOSE&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
</tbody>
</table>
<p>A record with <code>PARAMCD == &quot;TDOSE&quot;</code> is created with <code>PARCAT1</code> set to <code>&quot;OVERALL&quot;</code> using the records in <code>ADEX</code> where <code>PARAMCD == &quot;DOSE&quot;</code> by summing <code>AVAL</code>. In addition, the <code>ASTDT</code>, and <code>AENDT</code> are created as the minimum and maximum date/times associated with each <code>by_vars</code> grouping. Note that, in addition to <code>PARAMCD</code>, <code>PARCAT1</code>, <code>AVAL</code>, <code>ASTDT</code> and <code>AENDT</code>, only those variables specified in the <code>by_vars</code> argument will be populated in the new records.</p>
<p>Multiple parameters (records) may be created at one time using the <code>call_derivation()</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">call_derivation</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">derivation =</span> derive_param_exposure,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable_params =</span> <span class="fu">list</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">params</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TDOSE&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_code =</span> <span class="st">&quot;DOSE&quot;</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">analysis_var =</span> AVAL,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">params</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TPDOSE&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_code =</span> <span class="st">&quot;PLDOSE&quot;</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">analysis_var =</span> AVAL,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">params</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TDURD&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_code =</span> <span class="st">&quot;DURD&quot;</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">analysis_var =</span> AVAL,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">params</span>(</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TADJ&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_code =</span> <span class="st">&quot;ADJ&quot;</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">analysis_var =</span> AVALC,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">if_else</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;Y&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">params</span>(</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TADJAE&quot;</span>, <span class="at">PARCAT1 =</span> <span class="st">&quot;OVERALL&quot;</span>),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">input_code =</span> <span class="st">&quot;ADJAE&quot;</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">analysis_var =</span> AVALC,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary_fun =</span> <span class="cf">function</span>(x) <span class="fu">if_else</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;Y&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(adex, PARAMCD, PARCAT1)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 x 3</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    PARAMCD PARCAT1        n</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ADJ     INDIVIDUAL    13</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 ADJAE   INDIVIDUAL    13</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 DOSE    INDIVIDUAL    13</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 DURD    INDIVIDUAL    13</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 PLDOSE  INDIVIDUAL    13</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 TADJ    OVERALL        6</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 TADJAE  OVERALL        6</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 TDOSE   OVERALL        6</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 TDURD   OVERALL        6</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 TPDOSE  OVERALL        6</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">NA</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
</tbody>
</table>
<p>Dose intensity can be calculated using the function <code>derive_param_doseint()</code>. The planned dose and administered dose are passed into the function and a new record is created with the dose intensity calculation. Again, only those variables specified in the <code>by_vars</code> argument will be populated in this new record.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">derive_param_doseint</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, <span class="sc">!!!</span>adsl_vars),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">set_values_to =</span> <span class="fu">exprs</span>(<span class="at">PARAMCD =</span> <span class="st">&quot;TNDOSINT&quot;</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tadm_code =</span> <span class="st">&quot;TDOSE&quot;</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpadm_code =</span> <span class="st">&quot;TPDOSE&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="13%" />
<col width="10%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="8%" />
<col width="5%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">EXSTDTC</th>
<th align="left">EXENDTC</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-16</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">153</td>
<td align="left">2014-01-17</td>
<td align="left">2014-06-18</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">14</td>
<td align="left">2014-06-19</td>
<td align="left">2014-07-02</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">23</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-27</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">5</td>
<td align="left">2012-08-28</td>
<td align="left">2012-09-01</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">BASELINE</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-16</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">79</td>
<td align="left">2012-09-17</td>
<td align="left">2012-12-04</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">BASELINE</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">16</td>
<td align="left">2013-01-25</td>
<td align="left">2013-02-09</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">35</td>
<td align="left">2013-02-10</td>
<td align="left">2013-03-16</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">BASELINE</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">5</td>
<td align="left">2013-12-20</td>
<td align="left">2013-12-24</td>
</tr>
</tbody>
</table>
<p>The default calculation for dose intensity is: Administered Doses / Planned Doses * 100.</p>
<p>Please see the <code>derive_param_doseint()</code> documentation to see how planned doses of 0 or <code>NA</code> are handled.</p>
</div>
<div id="paramcd" class="section level2">
<h2>Assign <code>PARAMCD</code>, <code>PARAMN</code>, etc. from Reference tables</h2>
<p>To assign parameter level values such as <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code>, etc., a lookup can be created to join to the source data.</p>
<p>For example, when creating <code>ADEX</code>, a lookup based on the ADaM <code>PARAMCD</code> value may be created:</p>
<table>
<thead>
<tr class="header">
<th>PARAMCD</th>
<th>PARAM</th>
<th>PARAMN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DURD</td>
<td>Study drug duration during constant dosing interval (days)</td>
<td>1</td>
</tr>
<tr class="even">
<td>DOSE</td>
<td>Dose administered during constant dosing interval (mg)</td>
<td>2</td>
</tr>
<tr class="odd">
<td>PLDOSE</td>
<td>Planned dose during constant dosing interval (mg)</td>
<td>3</td>
</tr>
<tr class="even">
<td>ADJ</td>
<td>Dose adjusted during constant dosing interval</td>
<td>4</td>
</tr>
<tr class="odd">
<td>ADJAE</td>
<td>Dose adjusted due to AE during constant dosing interval</td>
<td>5</td>
</tr>
<tr class="even">
<td>TDURD</td>
<td>Overall duration (days)</td>
<td>6</td>
</tr>
<tr class="odd">
<td>TDOSE</td>
<td>Total dose administered (mg)</td>
<td>7</td>
</tr>
<tr class="even">
<td>TPDOSE</td>
<td>Total planned dose (mg)</td>
<td>9</td>
</tr>
<tr class="odd">
<td>TADJ</td>
<td>Dose adjusted during study</td>
<td>10</td>
</tr>
<tr class="even">
<td>TADJAE</td>
<td>Dose adjusted during study due to AE</td>
<td>11</td>
</tr>
<tr class="odd">
<td>TNDOSINT</td>
<td>Overall dose intensity (%)</td>
<td>12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_vars_merged</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  adex,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_add =</span> param_lookup,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(PARAMCD)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(adex, PARAMCD, PARAM, PARAMN)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 11 x 4</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    PARAMCD  PARAM                                                   PARAMN     n</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;                                                    &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ADJ      Dose adjusted during constant dosing interval                4    13</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 ADJAE    Dose adjusted  due to AE during constant dosing interv…      5    13</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 DOSE     Dose administered during constant dosing interval (mg)       2    13</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 DURD     Study drug duration during constant dosing interval (d…      1    13</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 PLDOSE   Planned dose during constant dosing interval (mg)            3    13</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 TADJ     Dose adjusted during study                                  10     6</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 TADJAE   Dose adjusted during study due to AE                        11     6</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 TDOSE    Total dose administered (mg)                                 7     6</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 TDURD    Overall duration (days)                                      6     6</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 TNDOSINT Overall dose intensity (%)                                  12     6</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 TPDOSE   Total planned dose (mg)                                      9     6</span></span></code></pre></div>
<p>Please note, this is an example only and additional columns may be needed for the join depending on your lookup/metadata table.</p>
</div>
<div id="cat" class="section level2">
<h2>Derive Categorization Variables (<code>AVALCATx</code>)</h2>
<p><code>{admiral}</code> does not currently have a generic function to aid in assigning <code>AVALCATx</code>/ <code>AVALCAxN</code> values. Below is a simple example of how these values may be assigned using the <code>dplyr::mutate</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVALCAT1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TDURD&quot;</span>) <span class="sc">&amp;</span> AVAL <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">&quot;&lt; 30 days&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TDURD&quot;</span>) <span class="sc">&amp;</span> AVAL <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> AVAL <span class="sc">&lt;</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">&quot;&gt;= 30 and &lt; 90 days&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TDURD&quot;</span>) <span class="sc">&amp;</span> AVAL <span class="sc">&gt;=</span> <span class="dv">90</span> <span class="sc">~</span> <span class="st">&quot;&gt;=90 days&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TDOSE&quot;</span>, <span class="st">&quot;TPDOSE&quot;</span>) <span class="sc">&amp;</span> AVAL <span class="sc">&lt;</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="st">&quot;&lt; 1000 mg&quot;</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TDOSE&quot;</span>, <span class="st">&quot;TPDOSE&quot;</span>) <span class="sc">&amp;</span> AVAL <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="st">&quot;&gt;= 1000 mg&quot;</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">AVALCAT1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">OVERALL</td>
<td align="left">TDOSE</td>
<td align="right">0</td>
<td align="left">&lt; 1000 mg</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">OVERALL</td>
<td align="left">TPDOSE</td>
<td align="right">0</td>
<td align="left">&lt; 1000 mg</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">OVERALL</td>
<td align="left">TDURD</td>
<td align="right">182</td>
<td align="left">&gt;=90 days</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">PLDOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">153</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="aseq" class="section level2">
<h2>Assign <code>ASEQ</code></h2>
<p>The <code>{admiral}</code> function <code>derive_var_obs_number()</code> can be used to derive <code>ASEQ</code>. An example call is:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> <span class="fu">derive_var_obs_number</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  adex,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_var =</span> ASEQ,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="fu">exprs</span>(PARCAT1, ASTDT, VISIT, VISITNUM, EXSEQ, PARAMN),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">check_type =</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="left">ASTDT</th>
<th align="right">ASEQ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">15</td>
<td align="left">2014-01-02</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">2014-01-02</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">PLDOSE</td>
<td align="right">0</td>
<td align="left">2014-01-02</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">2014-01-02</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">2014-01-02</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DURD</td>
<td align="right">153</td>
<td align="left">2014-01-17</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">DOSE</td>
<td align="right">0</td>
<td align="left">2014-01-17</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">PLDOSE</td>
<td align="right">0</td>
<td align="left">2014-01-17</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJ</td>
<td align="right">NA</td>
<td align="left">2014-01-17</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="left">INDIVIDUAL</td>
<td align="left">ADJAE</td>
<td align="right">NA</td>
<td align="left">2014-01-17</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
</div>
<div id="adsl_vars" class="section level2">
<h2>Add the <code>ADSL</code> variables</h2>
<p>If needed, the other <code>ADSL</code> variables can now be added:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>adex <span class="ot">&lt;-</span> adex <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset_add =</span> <span class="fu">select</span>(adsl, <span class="sc">!!!</span><span class="fu">negate_vars</span>(adsl_vars)),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="attributes" class="section level2">
<h2>Add Labels and Attributes</h2>
<p>Adding labels and attributes for SAS transport files is supported by the following packages:</p>
<ul>
<li><p><a href="https://atorus-research.github.io/metacore/">metacore</a>: establish a common foundation for the use of metadata within an R session.</p></li>
<li><p><a href="https://pharmaverse.github.io/metatools/">metatools</a>: enable the use of metacore objects. Metatools can be used to build datasets or enhance columns in existing datasets as well as checking datasets against the metadata.</p></li>
<li><p><a href="https://atorus-research.github.io/xportr/">xportr</a>: functionality to associate all metadata information to a local R data frame, perform data set level validation checks and convert into a <a href="https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/movefile/n1xbwdre0giahfn11c99yjkpi2yb.htm">transport v5 file(xpt)</a>.</p></li>
</ul>
<p>NOTE: All these packages are in the experimental phase, but the vision is to have them associated with an End to End pipeline under the umbrella of the <a href="https://github.com/pharmaverse">pharmaverse</a>. An example of applying metadata and perform associated checks can be found at the <a href="https://examples.pharmaverse.org/data/adsl/">pharmaverse E2E example</a>.</p>
</div>
</div>
<div id="example" class="section level1">
<h1>Example Scripts</h1>
<table>
<thead>
<tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADEX</td>
<td><a href="https://github.com/pharmaverse/admiral/blob/main/inst/templates/ad_adex.R" target="_blank">ad_adex.R</a></td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
