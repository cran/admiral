<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Creating a BDS Finding ADaM</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Creating a BDS Finding ADaM</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This article describes creating a BDS finding ADaM. Examples are currently presented and tested in the context of ADVS. However, the examples could be applied to other BDS Finding ADaMs such as ADEG, ADLB, etc. where a single result is captured in an SDTM Finding domain on a single date and/or time.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM format as input unless otherwise specified.</em></p>
</div>
<div id="programming-workflow" class="section level1">
<h1>Programming Workflow</h1>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#datetime">Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</a></li>
<li><a href="#paramcd">Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code></a></li>
<li><a href="#aval">Derive Results (<code>AVAL</code>, <code>AVALC</code>)</a></li>
<li><a href="#derive_param">Derive Additional Parameters (e.g. <code>BSA</code>, <code>BMI</code>, or <code>MAP</code> for <code>ADVS</code>)</a></li>
<li><a href="#timing">Derive Timing Variables (e.g. <code>APHASE</code>, <code>AVISIT</code>, <code>APERIOD</code>)</a></li>
<li><a href="#timingflag">Timing Flag Variables (e.g. <code>ONTRTFL</code>)</a></li>
<li><a href="#referencerange">Assign Reference Range Indicator (<code>ANRIND</code>)</a></li>
<li><a href="#baseline">Derive Baseline (<code>BASETYPE</code>, <code>ABLFL</code>, <code>BASE</code>, <code>BASEC</code>, <code>BNRIND</code>)</a></li>
<li><a href="#bchange">Derive Change from Baseline (<code>CHG</code>, <code>PCHG</code>)</a></li>
<li><a href="#analysisrec">Derive Analysis Flags (e.g. <code>ANL01FL</code>)</a></li>
<li><a href="#treatment">Assign Treatment (<code>TRTA</code>, <code>TRTP</code>)</a></li>
<li><a href="#aseq">Assign <code>ASEQ</code></a></li>
<li><a href="#cat">Derive Categorization Variables (<code>AVALCATx</code>)</a></li>
<li><a href="#adsl_vars">Add ADSL variables</a></li>
<li><a href="#additional">Derive New Rows</a></li>
</ul>
<div id="readdata" class="section level2">
<h2>Read in Data</h2>
<p>To start, all data frames needed for the creation of <code>ADVS</code> should be read into the environment. This will be a company specific process. Some of the data frames needed may be <code>VS</code>, <code>SUPPVS</code>, and <code>ADSL</code>.</p>
<p>For example purpose, the CDISC Pilot SDTM and ADaM datasets—which are included in <code>{admiral.test}</code>—are used.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(admiral)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(admiral.test)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(tibble)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">data</span>(<span class="st">&quot;adsl&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">data</span>(<span class="st">&quot;vs&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a>vs &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vs)</span></code></pre></div>
<p>The <code>SUPPVS</code> domain can be joined to the <code>VS</code> domain using the function <code>derive_vars_suppqual()</code>.</p>
<p>This function will transpose the supplemental SDTM domain (e.g. <code>SUPPVS</code>) and join the transposed data to the parent domain (e.g. <code>VS</code>) by <code>STUDYID</code>, <code>USUBJID</code> using the <code>IDVAR</code> and <code>IDVARVAL</code> as an additional join variable.</p>
<p>Example call:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>vs &lt;-<span class="st"> </span><span class="kw">derive_vars_suppqual</span>(vs, suppvs)</span></code></pre></div>
<p>Please note, the CDISC pilot did not include a <code>SUPPVS</code> dataset and therefore this join is not demonstrated.</p>
<p>At this step, it may be useful to join <code>ADSL</code> to your <code>VS</code> domain. Only the <code>ADSL</code> variables used for derivations are selected at this step. The rest of the relevant <code>ADSL</code> would be added later.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a>adsl_vars &lt;-<span class="st"> </span><span class="kw">vars</span>(TRTSDT, TRTEDT, TRT01A, TRT01P)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a>advs &lt;-<span class="st"> </span><span class="kw">left_join</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>  vs,</span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="kw">select</span>(adsl, STUDYID, USUBJID, <span class="op">!!!</span>adsl_vars),</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;STUDYID&quot;</span>, <span class="st">&quot;USUBJID&quot;</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VSTESTCD</th>
<th align="left">VSDTC</th>
<th align="left">VISIT</th>
<th align="left">TRTSDT</th>
<th align="left">TRTEDT</th>
<th align="left">TRT01A</th>
<th align="left">TRT01P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Xan_Lo</td>
<td align="left">Xan_Lo</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Xan_Lo</td>
<td align="left">Xan_Lo</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">WEEK 2</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Xan_Lo</td>
<td align="left">Xan_Lo</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">DIABP</td>
<td align="left">2013-02-09</td>
<td align="left">WEEK 2</td>
<td align="left">2013-01-25</td>
<td align="left">2013-03-16</td>
<td align="left">Pbo</td>
<td align="left">Pbo</td>
</tr>
</tbody>
</table>
</div>
<div id="datetime" class="section level2">
<h2>Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</h2>
<p>The function <code>derive_vars_dt()</code> can be used to derive <code>ADT</code>. This function allows the user to impute the date as well.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_vars_dt</span>(advs, <span class="dt">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">dtc =</span> VSDTC)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">VSDTC</th>
<th align="left">ADT</th>
<th align="left">ADTF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 1</td>
<td align="left">2013-12-26</td>
<td align="left">2013-12-26</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 1</td>
<td align="left">2013-12-26</td>
<td align="left">2013-12-26</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 1</td>
<td align="left">2013-12-26</td>
<td align="left">2013-12-26</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 2</td>
<td align="left">2013-12-31</td>
<td align="left">2013-12-31</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 2</td>
<td align="left">2013-12-31</td>
<td align="left">2013-12-31</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SCREENING 2</td>
<td align="left">2013-12-31</td>
<td align="left">2013-12-31</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">2014-01-14</td>
<td align="left">2014-01-14</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>If imputation is needed and the date is to be imputed to the first of the month, the call would be:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_vars_dt</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>  advs, </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>, </span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">dtc =</span> VSDTC, </span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dt">date_imputation =</span> <span class="st">&quot;FIRST&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">VSDTC</th>
<th align="left">ADT</th>
<th align="left">ADTF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07</td>
<td align="left">2012-07-01</td>
<td align="left">D</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07</td>
<td align="left">2012-07-01</td>
<td align="left">D</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07</td>
<td align="left">2012-07-01</td>
<td align="left">D</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="left">2012-07-07</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="left">2012-07-07</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="left">2012-07-07</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="left">2012-07-09</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="left">2012-07-09</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="left">2012-07-09</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">2012-07-22</td>
<td align="left">2012-07-22</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Similarly, <code>ADTM</code> may be created using the function <code>derive_vars_dtm()</code>. Imputation may be done on both the date and time components of <code>ADTM</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># CDISC Pilot data does not contain times and the output of the derivation</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># ADTM is not presented.</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_vars_dtm</span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>  advs, </span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="dt">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>, </span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="dt">dtc =</span> VSDTC, </span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="dt">date_imputation =</span> <span class="st">&quot;FIRST&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>)</span></code></pre></div>
<p>By default, the variable <code>ADTF</code> for <code>derive_vars_dt()</code> or <code>ADTF</code> and <code>ATMF</code> for <code>derive_vars_dtm()</code> will be created and populated with the controlled terminology outlined in the ADaM IG for date imputations.</p>
<p>See also <a href="imputation.html">Date and Time Imputation</a>.</p>
<p>Once <code>ADT</code> is derived, the function <code>derive_var_ady()</code> can be used to derive <code>ADY</code>. This example assumes both <code>ADT</code> and <code>TRTSDT</code> exist on the data frame.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_ady</span>(advs, <span class="dt">reference_date =</span> TRTSDT, <span class="dt">date =</span> ADT)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ADT</th>
<th align="right">ADY</th>
<th align="left">TRTSDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07-06</td>
<td align="right">-3</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07-06</td>
<td align="right">-3</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 1</td>
<td align="left">2012-07-06</td>
<td align="right">-3</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="right">-2</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="right">-2</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">SCREENING 2</td>
<td align="left">2012-07-07</td>
<td align="right">-2</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="right">1</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="right">1</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">BASELINE</td>
<td align="left">2012-07-09</td>
<td align="right">1</td>
<td align="left">2012-07-09</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">2012-07-22</td>
<td align="right">14</td>
<td align="left">2012-07-09</td>
</tr>
</tbody>
</table>
</div>
<div id="paramcd" class="section level2">
<h2>Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code></h2>
<p>To assign parameter level values such as <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code>, etc., a lookup can be created to join to the source data.</p>
<p>For example, when creating <code>ADVS</code>, a lookup based on the SDTM <code>--TESTCD</code> value may be created:</p>
<table>
<thead>
<tr class="header">
<th><code>VSTESTCD</code></th>
<th><code>PARAMCD</code></th>
<th><code>PARAM</code></th>
<th><code>PARAMN</code></th>
<th><code>PARCAT1</code></th>
<th><code>PARCAT1N</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>HEIGHT</td>
<td>HEIGHT</td>
<td>Height (cm)</td>
<td>1</td>
<td>Subject Characteristic</td>
<td>1</td>
</tr>
<tr class="even">
<td>WEIGHT</td>
<td>WEIGHT</td>
<td>Weight (kg)</td>
<td>2</td>
<td>Subject Characteristic</td>
<td>1</td>
</tr>
<tr class="odd">
<td>DIABP</td>
<td>DIABP</td>
<td>Diastolic Blood Pressure (mmHg)</td>
<td>3</td>
<td>Vital Sign</td>
<td>2</td>
</tr>
<tr class="even">
<td>MAP</td>
<td>MAP</td>
<td>Mean Arterial Pressure</td>
<td>4</td>
<td>Vital Sign</td>
<td>2</td>
</tr>
<tr class="odd">
<td>PULSE</td>
<td>PULSE</td>
<td>Pulse Rate (beats/min)</td>
<td>5</td>
<td>Vital Sign</td>
<td>2</td>
</tr>
<tr class="even">
<td>SYSBP</td>
<td>SYSBP</td>
<td>Systolic Blood Pressure (mmHg)</td>
<td>6</td>
<td>Vital Sign</td>
<td>2</td>
</tr>
<tr class="odd">
<td>TEMP</td>
<td>TEMP</td>
<td>Temperature (C)</td>
<td>7</td>
<td>Vital Sign</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>This lookup may now be joined to the source data:</p>
<p>At this stage, only <code>PARAMCD</code> is required to perform the derivations. Additional derived parameters may be added, so only <code>PARAMCD</code> is joined to the datasets at this point. All other variables related to <code>PARAMCD</code> (e.g. <code>PARAM</code>, <code>PARAMCAT1</code>, …) will be added when all <code>PARAMCD</code> are derived.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>advs &lt;-<span class="st"> </span><span class="kw">left_join</span>(advs, <span class="kw">select</span>(param_lookup, VSTESTCD, PARAMCD), <span class="dt">by =</span> <span class="st">&quot;VSTESTCD&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VSTESTCD</th>
<th align="left">PARAMCD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">DIABP</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">HEIGHT</td>
<td align="left">HEIGHT</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">PULSE</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SYSBP</td>
<td align="left">SYSBP</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">TEMP</td>
<td align="left">TEMP</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEIGHT</td>
<td align="left">WEIGHT</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">DIABP</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">HEIGHT</td>
<td align="left">HEIGHT</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">PULSE</td>
<td align="left">PULSE</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">SYSBP</td>
<td align="left">SYSBP</td>
</tr>
</tbody>
</table>
<p>Please note, it may be necessary to include other variables in the join. For example, perhaps the <code>PARAMCD</code> is based on <code>VSTESTCD</code> and <code>VSPOS</code>, it may be necessary to expand this lookup or create a separate look up for <code>PARAMCD</code>.</p>
</div>
<div id="aval" class="section level2">
<h2>Derive Results (<code>AVAL</code>, <code>AVALC</code>)</h2>
<p>The mapping of <code>AVAL</code> and <code>AVALC</code> is left to the ADaM programmer. An example mapping may be:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>advs &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  advs, </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="dt">AVAL =</span> VSSTRESN,</span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="dt">AVALC =</span> VSSTRESC</span>
<span id="cb9-5"><a href="#cb9-5"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">VSTESTCD</th>
<th align="left">PARAMCD</th>
<th align="right">VSSTRESN</th>
<th align="left">VSSTRESC</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">74</td>
<td align="left">74</td>
<td align="right">74</td>
<td align="left">74</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">74</td>
<td align="left">74</td>
<td align="right">74</td>
<td align="left">74</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">72</td>
<td align="left">72</td>
<td align="right">72</td>
<td align="left">72</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">78</td>
<td align="left">78</td>
<td align="right">78</td>
<td align="left">78</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">84</td>
<td align="left">84</td>
<td align="right">84</td>
<td align="left">84</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">78</td>
<td align="left">78</td>
<td align="right">78</td>
<td align="left">78</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">80</td>
<td align="left">80</td>
<td align="right">80</td>
<td align="left">80</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">80</td>
<td align="left">80</td>
<td align="right">80</td>
<td align="left">80</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">84</td>
<td align="left">84</td>
<td align="right">84</td>
<td align="left">84</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="right">90</td>
<td align="left">90</td>
<td align="right">90</td>
<td align="left">90</td>
</tr>
</tbody>
</table>
</div>
<div id="derive_param" class="section level2">
<h2>Derive Additional Parameters (e.g. <code>BSA</code>, <code>BMI</code> or <code>MAP</code> for <code>ADVS</code>)</h2>
<p>Optionally derive new parameters creating <code>PARAMCD</code> and <code>AVAL</code>. Below is an example of creating <code>Mean Arterial Pressure</code> for <code>ADVS</code>, see also Example 3 in section below <a href="#additional">Derive New Rows</a> for alternative way of creating new parameters.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_param_map</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>  advs,</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, <span class="op">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(<span class="dt">PARAMCD =</span> <span class="st">&quot;MAP&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="dt">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="dt">filter =</span> VSSTAT <span class="op">!=</span><span class="st"> &quot;NOT DONE&quot;</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(VSSTAT)</span>
<span id="cb10-7"><a href="#cb10-7"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">VSTESTCD</th>
<th align="left">PARAMCD</th>
<th align="left">VISIT</th>
<th align="left">VSTPT</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">64.00000</td>
<td align="left">64</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">MAP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">86.33333</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">SYSBP</td>
<td align="left">SYSBP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">131.00000</td>
<td align="left">131</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">83.00000</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">MAP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">98.33333</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">SYSBP</td>
<td align="left">SYSBP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">129.00000</td>
<td align="left">129</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">57.00000</td>
<td align="left">57</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">MAP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">87.00000</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">SYSBP</td>
<td align="left">SYSBP</td>
<td align="left">SCREENING 1</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">147.00000</td>
<td align="left">147</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">SCREENING 2</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">68.00000</td>
<td align="left">68</td>
</tr>
</tbody>
</table>
<p>Likewise, function call below, to create parameter <code>Body Surface Area</code> and <code>Body Mass Index</code> for <code>ADVS</code> domain.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_param_bsa</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  advs,</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, <span class="op">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="dt">method =</span> <span class="st">&quot;Mosteller&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(<span class="dt">PARAMCD =</span> <span class="st">&quot;BSA&quot;</span>),</span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="dt">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="dt">filter =</span> VSSTAT <span class="op">!=</span><span class="st"> &quot;NOT DONE&quot;</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(VSSTAT)</span>
<span id="cb11-8"><a href="#cb11-8"></a>)</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_param_bmi</span>(</span>
<span id="cb11-11"><a href="#cb11-11"></a>  advs,</span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, <span class="op">!!!</span>adsl_vars, VISIT, VISITNUM, ADT, ADY, VSTPT, VSTPTNUM),</span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(<span class="dt">PARAMCD =</span> <span class="st">&quot;BMI&quot;</span>),</span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="dt">get_unit_expr =</span> VSSTRESU,</span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="dt">filter =</span> VSSTAT <span class="op">!=</span><span class="st"> &quot;NOT DONE&quot;</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(VSSTAT)</span>
<span id="cb11-16"><a href="#cb11-16"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VSTESTCD</th>
<th align="left">PARAMCD</th>
<th align="left">VISIT</th>
<th align="left">VSTPT</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">BMI</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">24.871928</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">BSA</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">1.486264</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">NA</td>
<td align="left">BMI</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">29.694517</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">NA</td>
<td align="left">BSA</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">1.882381</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">NA</td>
<td align="left">BMI</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">24.665676</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">NA</td>
<td align="left">BSA</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">2.264029</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-703-1096</td>
<td align="left">NA</td>
<td align="left">BMI</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">31.886559</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">NA</td>
<td align="left">BSA</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">1.905083</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-707-1037</td>
<td align="left">NA</td>
<td align="left">BMI</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">23.826992</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-707-1037</td>
<td align="left">NA</td>
<td align="left">BSA</td>
<td align="left">SCREENING 1</td>
<td align="left">NA</td>
<td align="right">1.530597</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Similarly, for <code>ADEG</code> domain, the parameters <code>QTCBF</code> <code>QTCBS</code> and <code>QTCL</code> can be created with a function call. See example below for <code>PARAMCD</code> = <code>QTCF</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>adeg &lt;-<span class="st"> </span><span class="kw">derive_param_qtcf</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  adeg,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(USUBJID, VISIT, ADT),</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(<span class="dt">PARAMCD =</span> <span class="st">&quot;QTCFR&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>)</span></code></pre></div>
<p>When all <code>PARAMCD</code> have been derived and added to the dataset, the other information from the look-up table (<code>PARAM</code>, <code>PARAMCAT1</code>,…) should be added.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># Derive PARAM and PARAMN</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>advs &lt;-<span class="st"> </span><span class="kw">left_join</span>(advs, <span class="kw">select</span>(param_lookup, <span class="op">-</span>VSTESTCD), <span class="dt">by =</span> <span class="st">&quot;PARAMCD&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">VSTESTCD</th>
<th align="left">PARAMCD</th>
<th align="left">PARAM</th>
<th align="right">PARAMN</th>
<th align="left">PARCAT1</th>
<th align="right">PARCAT1N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">DIABP</td>
<td align="left">DIABP</td>
<td align="left">Diastolic Blood Pressure (mmHg)</td>
<td align="right">3</td>
<td align="left">Vital Sign</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="timing" class="section level2">
<h2>Derive Timing Variables (e.g. <code>APHASE</code>, <code>AVISIT</code>, <code>APERIOD</code>)</h2>
<p>Categorical timing variables are protocol and analysis dependent. Below is a simple example.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>advs &lt;-<span class="st"> </span>advs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="dt">AVISIT =</span> <span class="kw">case_when</span>(</span>
<span id="cb14-4"><a href="#cb14-4"></a>      <span class="kw">str_detect</span>(VISIT, <span class="st">&quot;SCREEN&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>      <span class="kw">str_detect</span>(VISIT, <span class="st">&quot;UNSCHED&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>      <span class="kw">str_detect</span>(VISIT, <span class="st">&quot;RETRIEVAL&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>      <span class="kw">str_detect</span>(VISIT, <span class="st">&quot;AMBUL&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>      <span class="op">!</span><span class="kw">is.na</span>(VISIT) <span class="op">~</span><span class="st"> </span><span class="kw">str_to_title</span>(VISIT)</span>
<span id="cb14-9"><a href="#cb14-9"></a>    ),</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="dt">AVISITN =</span> <span class="kw">as.numeric</span>(<span class="kw">case_when</span>(</span>
<span id="cb14-11"><a href="#cb14-11"></a>      VISIT <span class="op">==</span><span class="st"> &quot;BASELINE&quot;</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12"></a>      <span class="kw">str_detect</span>(VISIT, <span class="st">&quot;WEEK&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">str_trim</span>(<span class="kw">str_replace</span>(VISIT, <span class="st">&quot;WEEK&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-13"><a href="#cb14-13"></a>    )),</span>
<span id="cb14-14"><a href="#cb14-14"></a>    <span class="dt">ATPT =</span> VSTPT,</span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="dt">ATPTN =</span> VSTPTNUM</span>
<span id="cb14-16"><a href="#cb14-16"></a>  )</span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="kw">count</span>(advs, VISITNUM, VISIT, AVISITN, AVISIT)</span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt; # A tibble: 15 x 5</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt;    VISITNUM VISIT               AVISITN AVISIT       n</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt;       &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#&gt;  1      1   SCREENING 1              NA &lt;NA&gt;       102</span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="co">#&gt;  2      2   SCREENING 2              NA &lt;NA&gt;        78</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co">#&gt;  3      3   BASELINE                  0 Baseline    84</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="co">#&gt;  4      3.5 AMBUL ECG PLACEMENT      NA &lt;NA&gt;        65</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="co">#&gt;  5      4   WEEK 2                    2 Week 2      84</span></span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="co">#&gt;  6      5   WEEK 4                    4 Week 4      70</span></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="co">#&gt;  7      6   AMBUL ECG REMOVAL        NA &lt;NA&gt;        52</span></span>
<span id="cb14-30"><a href="#cb14-30"></a><span class="co">#&gt;  8      7   WEEK 6                    6 Week 6      42</span></span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="co">#&gt;  9      8   WEEK 8                    8 Week 8      42</span></span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="co">#&gt; 10      9   WEEK 12                  12 Week 12     42</span></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="co">#&gt; 11     10   WEEK 16                  16 Week 16     42</span></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="co">#&gt; 12     11   WEEK 20                  20 Week 20     28</span></span>
<span id="cb14-35"><a href="#cb14-35"></a><span class="co">#&gt; 13     12   WEEK 24                  24 Week 24     28</span></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="co">#&gt; 14     13   WEEK 26                  26 Week 26     28</span></span>
<span id="cb14-37"><a href="#cb14-37"></a><span class="co">#&gt; 15    201   RETRIEVAL                NA &lt;NA&gt;        26</span></span>
<span id="cb14-38"><a href="#cb14-38"></a></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="kw">count</span>(advs, VSTPTNUM, VSTPT, ATPTN, ATPT)</span>
<span id="cb14-40"><a href="#cb14-40"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb14-41"><a href="#cb14-41"></a><span class="co">#&gt;   VSTPTNUM VSTPT                        ATPTN ATPT                             n</span></span>
<span id="cb14-42"><a href="#cb14-42"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;                        &lt;int&gt;</span></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="co">#&gt; 1      815 AFTER LYING DOWN FOR 5 MINU…   815 AFTER LYING DOWN FOR 5 MINU…   232</span></span>
<span id="cb14-44"><a href="#cb14-44"></a><span class="co">#&gt; 2      816 AFTER STANDING FOR 1 MINUTE    816 AFTER STANDING FOR 1 MINUTE    232</span></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="co">#&gt; 3      817 AFTER STANDING FOR 3 MINUTES   817 AFTER STANDING FOR 3 MINUTES   232</span></span>
<span id="cb14-46"><a href="#cb14-46"></a><span class="co">#&gt; 4       NA &lt;NA&gt;                            NA &lt;NA&gt;                           117</span></span></code></pre></div>
</div>
<div id="timingflag" class="section level2">
<h2>Timing Flag Variables (e.g. <code>ONTRTFL</code>)</h2>
<p>In some analyses, it may be necessary to flag an observation as on-treatment. The admiral function <code>derive_var_ontrtfl()</code> can be used.</p>
<p>For example, if on-treatment is defined as any observation between treatment start and treatment end, the flag may be derived as:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_ontrtfl</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  advs, </span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="dt">start_date =</span> ADT, </span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="dt">ref_start_date =</span> TRTSDT, </span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="dt">ref_end_date =</span> TRTEDT</span>
<span id="cb15-6"><a href="#cb15-6"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">ADT</th>
<th align="left">TRTSDT</th>
<th align="left">TRTEDT</th>
<th align="left">ONTRTFL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-05</td>
<td align="left">2012-09-01</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">2012-09-16</td>
<td align="left">2012-09-02</td>
<td align="left">2012-12-04</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">DIABP</td>
<td align="left">2013-02-09</td>
<td align="left">2013-01-25</td>
<td align="left">2013-03-16</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>This function returns the original data frame with the column <code>ONTRTFL</code> added. Additionally, this function does have functionality to handle a window on the <code>ref_end_date</code>. For example, if on-treatment is defined as between treatment start and treatment end plus 60 days, the call would be:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_ontrtfl</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  advs, </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="dt">start_date =</span> ADT, </span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="dt">ref_start_date =</span> TRTSDT, </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="dt">ref_end_date =</span> TRTEDT,</span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="dt">ref_end_window =</span> <span class="dv">60</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>)</span></code></pre></div>
<p>In addition, the function does allow you to filter out pre-treatment observations that occurred on the start date. For example, if observations with <code>VSTPT == PRE</code> should not be considered on-treatment when the observation date falls between the treatment start and end date, the user may specify this using the <code>filter_pre_timepoint</code> parameter:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_ontrtfl</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  advs,</span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="dt">start_date =</span> ADT,</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="dt">ref_start_date =</span> TRTSDT,</span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="dt">ref_end_date =</span> TRTEDT,</span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="dt">filter_pre_timepoint =</span> ATPT <span class="op">==</span><span class="st"> &quot;AFTER LYING DOWN FOR 5 MINUTES&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>)</span></code></pre></div>
<p>Lastly, the function does allow you to create any on-treatment flag based on the analysis needs. For example, if variable <code>ONTR01FL</code> is needed, showing the on-treatment flag during Period 01, you need to set <code>new var = ONTR01FL</code>. In addition, for Period 01 Start Date and Period 01 End Date, you need <code>ref_start_date = AP01SDT</code> and <code>ref_end_date = AP01EDT</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_ontrtfl</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a> advs,</span>
<span id="cb18-3"><a href="#cb18-3"></a> <span class="dt">new_var =</span> ONTR01FL,</span>
<span id="cb18-4"><a href="#cb18-4"></a> <span class="dt">start_date =</span> ASTDT,</span>
<span id="cb18-5"><a href="#cb18-5"></a> <span class="dt">end_date =</span> AENDT,</span>
<span id="cb18-6"><a href="#cb18-6"></a> <span class="dt">ref_start_date =</span> AP01SDT,</span>
<span id="cb18-7"><a href="#cb18-7"></a> <span class="dt">ref_end_date =</span> AP01EDT,</span>
<span id="cb18-8"><a href="#cb18-8"></a> <span class="dt">span_period =</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">ASTDT</th>
<th align="left">AENDT</th>
<th align="left">AP01SDT</th>
<th align="left">AP01EDT</th>
<th align="left">ONTR01FL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">P01</td>
<td align="left">2020-03-15</td>
<td align="left">2020-12-01</td>
<td align="left">2020-01-01</td>
<td align="left">2020-03-01</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">P02</td>
<td align="left">2019-04-30</td>
<td align="left">2020-03-15</td>
<td align="left">2020-01-01</td>
<td align="left">2020-03-01</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">P03</td>
<td align="left">2019-04-30</td>
<td align="left">NA</td>
<td align="left">2020-01-01</td>
<td align="left">2020-03-01</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
</div>
<div id="referencerange" class="section level2">
<h2>Assign Reference Range Indicator (<code>ANRIND</code>)</h2>
<p>The admiral function <code>derive_var_anrind()</code> may be used to derive the reference range indicator <code>ANRIND</code>.</p>
<p>This function requires the reference range boundaries to exist on the data frame (<code>ANRLO</code>, <code>ANRHI</code>) and also accommodates the additional boundaries <code>A1LO</code> and <code>A1HI</code>.</p>
<p>The function is called as:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_anrind</span>(advs)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="right">ANRLO</th>
<th align="right">ANRHI</th>
<th align="right">A1LO</th>
<th align="right">A1HI</th>
<th align="left">ANRIND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">56</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">LOW</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">50</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">LOW</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">54</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">LOW</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="right">88</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">HIGH</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="right">86</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">HIGH</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="right">90</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">HIGH</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="right">68</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">NORMAL</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="right">74</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">NORMAL</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="right">70</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">NORMAL</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">DIABP</td>
<td align="right">74</td>
<td align="right">60</td>
<td align="right">80</td>
<td align="right">40</td>
<td align="right">90</td>
<td align="left">NORMAL</td>
</tr>
</tbody>
</table>
</div>
<div id="baseline" class="section level2">
<h2>Derive Baseline (<code>BASETYPE</code>, <code>ABLFL</code>, <code>BASE</code>, <code>BASEC</code>, <code>BNRIND</code>)</h2>
<p>The <code>BASETYPE</code> should be derived using the function <code>derive_var_basetype()</code>. The parameter basetypes of this function requires a named list of expression detailing how the <code>BASETYPE</code> should be assigned. Note, if a record falls into multiple expressions within the basetypes expression, a row will be produced for each <code>BASETYPE</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_basetype</span>(</span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="dt">dataset =</span> advs,</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="dt">basetypes =</span> <span class="kw">exprs</span>(</span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="st">&quot;LAST: AFTER LYING DOWN FOR 5 MINUTES&quot;</span> =<span class="st"> </span>ATPTN <span class="op">==</span><span class="st"> </span><span class="dv">815</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="st">&quot;LAST: AFTER STANDING FOR 1 MINUTE&quot;</span> =<span class="st"> </span>ATPTN <span class="op">==</span><span class="st"> </span><span class="dv">816</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="st">&quot;LAST: AFTER STANDING FOR 3 MINUTES&quot;</span> =<span class="st"> </span>ATPTN <span class="op">==</span><span class="st"> </span><span class="dv">817</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>    <span class="st">&quot;LAST&quot;</span> =<span class="st"> </span><span class="kw">is.na</span>(ATPTN)</span>
<span id="cb20-8"><a href="#cb20-8"></a>  )</span>
<span id="cb20-9"><a href="#cb20-9"></a>)</span>
<span id="cb20-10"><a href="#cb20-10"></a></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="kw">count</span>(advs, ATPT, ATPTN, BASETYPE)</span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">#&gt;   ATPT                           ATPTN BASETYPE                                n</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">#&gt;   &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;                               &lt;int&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co">#&gt; 1 AFTER LYING DOWN FOR 5 MINUTES   815 LAST: AFTER LYING DOWN FOR 5 MINUT…   232</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt; 2 AFTER STANDING FOR 1 MINUTE      816 LAST: AFTER STANDING FOR 1 MINUTE     232</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">#&gt; 3 AFTER STANDING FOR 3 MINUTES     817 LAST: AFTER STANDING FOR 3 MINUTES    232</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt; 4 &lt;NA&gt;                              NA LAST                                  117</span></span></code></pre></div>
<p>It is important to derive <code>BASETYPE</code> first so that it can be utilized in subsequent derivations. This will be important if the data frame contains multiple values for <code>BASETYPE</code>.</p>
<p>Next, the analysis baseline flag <code>ABLFL</code> can be derived using the <code>{admiral}</code> function <code>derive_var_extreme_flag()</code>. For example, if baseline is defined as the last non-missing <code>AVAL</code> prior or on <code>TRTSDT</code>, the function call for <code>ABLFL</code> would be:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_extreme_flag</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  advs,</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, BASETYPE, PARAMCD),</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="dt">order =</span> <span class="kw">vars</span>(ADT, ATPTN, VISITNUM),</span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="dt">new_var =</span> ABLFL,</span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="dt">filter =</span> (<span class="op">!</span><span class="kw">is.na</span>(AVAL) <span class="op">&amp;</span><span class="st"> </span>ADT <span class="op">&lt;=</span><span class="st"> </span>TRTSDT <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(BASETYPE))</span>
<span id="cb21-8"><a href="#cb21-8"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">BASETYPE</th>
<th align="left">PARAMCD</th>
<th align="left">ADT</th>
<th align="left">TRTSDT</th>
<th align="right">ATPTN</th>
<th align="left">ABLFL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="right">816</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="left">2014-01-02</td>
<td align="right">817</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-05</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-05</td>
<td align="right">816</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2012-08-05</td>
<td align="left">2012-08-05</td>
<td align="right">817</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-02</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-02</td>
<td align="right">816</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2012-09-02</td>
<td align="left">2012-09-02</td>
<td align="right">817</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">2013-01-25</td>
<td align="left">2013-01-25</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>Note: Additional examples of the <code>derive_var_extreme_flag()</code> function can be found <a href="#analysisrec">above.</a></p>
<p>Lastly, the <code>BASE</code>, <code>BASEC</code> and <code>BNRIND</code> columns can be derived using the <code>{admiral}</code> function <code>derive_var_base()</code>. Example calls are:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_base</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  advs,</span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="dt">source_var =</span> AVAL, </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="dt">new_var =</span> BASE</span>
<span id="cb22-6"><a href="#cb22-6"></a>)</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_base</span>(</span>
<span id="cb22-9"><a href="#cb22-9"></a>  advs,</span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="dt">source_var =</span> AVALC, </span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="dt">new_var =</span> BASEC</span>
<span id="cb22-13"><a href="#cb22-13"></a>)</span>
<span id="cb22-14"><a href="#cb22-14"></a></span>
<span id="cb22-15"><a href="#cb22-15"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_base</span>(</span>
<span id="cb22-16"><a href="#cb22-16"></a>  advs,</span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, PARAMCD, BASETYPE),</span>
<span id="cb22-18"><a href="#cb22-18"></a>  <span class="dt">source_var =</span> ANRIND, </span>
<span id="cb22-19"><a href="#cb22-19"></a>  <span class="dt">new_var =</span> BNRIND</span>
<span id="cb22-20"><a href="#cb22-20"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">BASETYPE</th>
<th align="left">PARAMCD</th>
<th align="left">ABLFL</th>
<th align="right">BASE</th>
<th align="left">BASEC</th>
<th align="left">ANRIND</th>
<th align="left">BNRIND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">56</td>
<td align="left">56</td>
<td align="left">LOW</td>
<td align="left">LOW</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">51</td>
<td align="left">51</td>
<td align="left">LOW</td>
<td align="left">LOW</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">61</td>
<td align="left">61</td>
<td align="left">NORMAL</td>
<td align="left">NORMAL</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">84</td>
<td align="left">84</td>
<td align="left">HIGH</td>
<td align="left">HIGH</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">86</td>
<td align="left">86</td>
<td align="left">HIGH</td>
<td align="left">HIGH</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">88</td>
<td align="left">88</td>
<td align="left">HIGH</td>
<td align="left">HIGH</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">80</td>
<td align="left">80</td>
<td align="left">NORMAL</td>
<td align="left">NORMAL</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER STANDING FOR 1 MINUTE</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">82</td>
<td align="left">82</td>
<td align="left">HIGH</td>
<td align="left">HIGH</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">LAST: AFTER STANDING FOR 3 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">72</td>
<td align="left">72</td>
<td align="left">NORMAL</td>
<td align="left">NORMAL</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">LAST: AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="left">DIABP</td>
<td align="left">Y</td>
<td align="right">70</td>
<td align="left">70</td>
<td align="left">NORMAL</td>
<td align="left">NORMAL</td>
</tr>
</tbody>
</table>
</div>
<div id="bchange" class="section level2">
<h2>Derive Change from Baseline (<code>CHG</code>, <code>PCHG</code>)</h2>
<p>Change and percent change from baseline can be derived using the <code>{admiral}</code> functions <code>derive_var_chg()</code> and <code>derive_var_pchg()</code>. These functions expect <code>AVAL</code> and <code>BASE</code> to exist in the data frame. The <code>CHG</code> is simply <code>AVAL - BASE</code> and the <code>PCHG</code> is <code>(AVAL - BASE) / absolute value (BASE) * 100</code>. Examples calls are:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_chg</span>(advs)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_pchg</span>(advs)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="right">BASE</th>
<th align="right">AVAL</th>
<th align="right">CHG</th>
<th align="right">PCHG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="right">56</td>
<td align="right">56</td>
<td align="right">0</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 8</td>
<td align="right">56</td>
<td align="right">67</td>
<td align="right">11</td>
<td align="right">19.642857</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">WEEK 2</td>
<td align="right">84</td>
<td align="right">88</td>
<td align="right">4</td>
<td align="right">4.761905</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">WEEK 2</td>
<td align="right">80</td>
<td align="right">68</td>
<td align="right">-12</td>
<td align="right">-15.000000</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">WEEK 8</td>
<td align="right">80</td>
<td align="right">80</td>
<td align="right">0</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">WEEK 2</td>
<td align="right">70</td>
<td align="right">74</td>
<td align="right">4</td>
<td align="right">5.714286</td>
</tr>
<tr class="odd">
<td align="left">01-707-1037</td>
<td align="left">WEEK 2</td>
<td align="right">88</td>
<td align="right">72</td>
<td align="right">-16</td>
<td align="right">-18.181818</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">WEEK 2</td>
<td align="right">80</td>
<td align="right">86</td>
<td align="right">6</td>
<td align="right">7.500000</td>
</tr>
<tr class="odd">
<td align="left">01-716-1024</td>
<td align="left">WEEK 8</td>
<td align="right">80</td>
<td align="right">78</td>
<td align="right">-2</td>
<td align="right">-2.500000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEEK 2</td>
<td align="right">51</td>
<td align="right">50</td>
<td align="right">-1</td>
<td align="right">-1.960784</td>
</tr>
</tbody>
</table>
</div>
<div id="analysisrec" class="section level2">
<h2>Derive Analysis Flags (e.g. <code>ANL01FL</code>)</h2>
<p>In most finding ADaMs, an analysis flag is derived to identify the appropriate observation(s) to use for a particular analysis when a subject has multiple observations within a particular timing period.</p>
<p>In this situation, an analysis flag (e.g. <code>ANLxxFL</code>) may be used to choose the appropriate record for analysis.</p>
<p>This flag may be derived using the <code>{admiral}</code> function <code>derive_var_extreme_flag()</code>. For this example, we will assume we would like to choose the latest and highest value by <code>USUBJID</code>, <code>PARAMCD</code>, <code>AVISIT</code>, and <code>ATPT</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_extreme_flag</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  advs,</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(USUBJID, PARAMCD, AVISIT),</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="dt">order =</span> <span class="kw">vars</span>(ADT, ATPTN, AVAL),</span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="dt">new_var =</span> ANL01FL,</span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="dt">filter =</span> <span class="op">!</span><span class="kw">is.na</span>(AVISITN)</span>
<span id="cb24-8"><a href="#cb24-8"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">AVISIT</th>
<th align="right">ATPTN</th>
<th align="left">ADT</th>
<th align="right">AVAL</th>
<th align="left">ANL01FL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">815</td>
<td align="left">2014-01-16</td>
<td align="right">56</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">816</td>
<td align="left">2014-01-16</td>
<td align="right">50</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">817</td>
<td align="left">2014-01-16</td>
<td align="right">54</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 8</td>
<td align="right">815</td>
<td align="left">2014-03-05</td>
<td align="right">67</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 8</td>
<td align="right">816</td>
<td align="left">2014-03-05</td>
<td align="right">62</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">Week 8</td>
<td align="right">817</td>
<td align="left">2014-03-05</td>
<td align="right">71</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">815</td>
<td align="left">2012-08-27</td>
<td align="right">88</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">816</td>
<td align="left">2012-08-27</td>
<td align="right">86</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">817</td>
<td align="left">2012-08-27</td>
<td align="right">90</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-703-1086</td>
<td align="left">DIABP</td>
<td align="left">Week 2</td>
<td align="right">815</td>
<td align="left">2012-09-16</td>
<td align="right">68</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Another common example would be flagging the worst value for a subject, parameter, and visit. For this example, we will assume we have 3 <code>PARAMCD</code> values (<code>SYSBP</code>, <code>DIABP</code>, and <code>RESP</code>). We will also assume high is worst for <code>SYSBP</code> and <code>DIABP</code> and low is worst for <code>RESP</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_worst_flag</span>(</span>
<span id="cb25-2"><a href="#cb25-2"></a>  advs,</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(USUBJID, PARAMCD, AVISIT),</span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="dt">order =</span> <span class="kw">vars</span>(ADT, ATPTN),</span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="dt">new_var =</span> WORSTFL,</span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="dt">param_var =</span> PARAMCD,</span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="dt">analysis_var =</span> AVAL,</span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="dt">worst_high =</span> <span class="kw">c</span>(<span class="st">&quot;SYSBP&quot;</span>, <span class="st">&quot;DIABP&quot;</span>),</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="dt">worst_low =</span> <span class="st">&quot;PULSE&quot;</span>,</span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="dt">filter =</span> <span class="op">!</span><span class="kw">is.na</span>(AVISIT) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(AVAL)</span>
<span id="cb25-11"><a href="#cb25-11"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">AVISIT</th>
<th align="right">AVAL</th>
<th align="left">ADT</th>
<th align="right">ATPTN</th>
<th align="left">WORSTFL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Baseline</td>
<td align="right">56</td>
<td align="left">2014-01-02</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Baseline</td>
<td align="right">59</td>
<td align="left">2014-01-02</td>
<td align="right">816</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Baseline</td>
<td align="right">59</td>
<td align="left">2014-01-02</td>
<td align="right">817</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 12</td>
<td align="right">52</td>
<td align="left">2014-03-26</td>
<td align="right">817</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 12</td>
<td align="right">53</td>
<td align="left">2014-03-26</td>
<td align="right">816</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 12</td>
<td align="right">54</td>
<td align="left">2014-03-26</td>
<td align="right">815</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 16</td>
<td align="right">55</td>
<td align="left">2014-05-07</td>
<td align="right">816</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 16</td>
<td align="right">60</td>
<td align="left">2014-05-07</td>
<td align="right">815</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 16</td>
<td align="right">61</td>
<td align="left">2014-05-07</td>
<td align="right">817</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">Week 2</td>
<td align="right">58</td>
<td align="left">2014-01-16</td>
<td align="right">815</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
</div>
<div id="treatment" class="section level2">
<h2>Assign Treatment (<code>TRTA</code>, <code>TRTP</code>)</h2>
<p><code>TRTA</code> and <code>TRTP</code> must correlate to treatment <code>TRTxxP</code> and/or <code>TRTxxA</code> in ADSL. The derivation of <code>TRTA</code> and <code>TRTP</code> for a record are protocol and analysis specific.<br />
<code>{admiral}</code> does not currently have functionality to assist with <code>TRTA</code> and <code>TRTP</code> assignment.</p>
<p>However, an example of a simple implementation could be:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>advs &lt;-<span class="st"> </span><span class="kw">mutate</span>(advs, <span class="dt">TRTP =</span> TRT01P, <span class="dt">TRTA =</span> TRT01A)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw">count</span>(advs, TRTP, TRTA, TRT01P, TRT01A)</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">#&gt; # A tibble: 2 x 5</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">#&gt;   TRTP   TRTA   TRT01P TRT01A     n</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">#&gt; 1 Pbo    Pbo    Pbo    Pbo      588</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#&gt; 2 Xan_Lo Xan_Lo Xan_Lo Xan_Lo   225</span></span></code></pre></div>
</div>
<div id="aseq" class="section level2">
<h2>Assign <code>ASEQ</code></h2>
<p>The <code>{admiral}</code> function <code>derive_var_obs_number()</code> can be used to derive <code>ASEQ</code>. An example call is:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>advs &lt;-<span class="st"> </span><span class="kw">derive_var_obs_number</span>(</span>
<span id="cb27-2"><a href="#cb27-2"></a>  advs,</span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="dt">new_var =</span> ASEQ,</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID),</span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="dt">order =</span> <span class="kw">vars</span>(PARAMCD, ADT, AVISITN, VISITNUM, ATPTN),</span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="dt">check_type =</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">ADT</th>
<th align="right">AVISITN</th>
<th align="right">ATPTN</th>
<th align="left">VISIT</th>
<th align="right">ASEQ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BMI</td>
<td align="left">2013-12-26</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">SCREENING 1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BSA</td>
<td align="left">2013-12-26</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">SCREENING 1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-26</td>
<td align="right">NA</td>
<td align="right">815</td>
<td align="left">SCREENING 1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-26</td>
<td align="right">NA</td>
<td align="right">816</td>
<td align="left">SCREENING 1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-26</td>
<td align="right">NA</td>
<td align="right">817</td>
<td align="left">SCREENING 1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-31</td>
<td align="right">NA</td>
<td align="right">815</td>
<td align="left">SCREENING 2</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-31</td>
<td align="right">NA</td>
<td align="right">816</td>
<td align="left">SCREENING 2</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2013-12-31</td>
<td align="right">NA</td>
<td align="right">817</td>
<td align="left">SCREENING 2</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="right">0</td>
<td align="right">815</td>
<td align="left">BASELINE</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="right">0</td>
<td align="right">816</td>
<td align="left">BASELINE</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
</div>
<div id="cat" class="section level2">
<h2>Derive Categorization Variables (<code>AVALCATx</code>)</h2>
<p>Admiral does not currently have a generic function to aid in assigning <code>AVALCATx</code>/ <code>AVALCAxN</code> values. Below is a simple example of how these values may be assigned:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>avalcat_lookup &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="op">~</span>PARAMCD, <span class="op">~</span>AVALCA1N, <span class="op">~</span>AVALCAT1,</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="st">&quot;HEIGHT&quot;</span>, <span class="dv">1</span>, <span class="st">&quot;&gt;140 cm&quot;</span>,</span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="st">&quot;HEIGHT&quot;</span>, <span class="dv">2</span>, <span class="st">&quot;&lt;= 140 cm&quot;</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>)</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>format_avalcat1n &lt;-<span class="st"> </span><span class="cf">function</span>(param, aval) {</span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="kw">case_when</span>(</span>
<span id="cb28-9"><a href="#cb28-9"></a>    param <span class="op">==</span><span class="st"> &quot;HEIGHT&quot;</span> <span class="op">&amp;</span><span class="st"> </span>aval <span class="op">&gt;</span><span class="st"> </span><span class="dv">140</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb28-10"><a href="#cb28-10"></a>    param <span class="op">==</span><span class="st"> &quot;HEIGHT&quot;</span> <span class="op">&amp;</span><span class="st"> </span>aval <span class="op">&lt;=</span><span class="st"> </span><span class="dv">140</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  )</span>
<span id="cb28-12"><a href="#cb28-12"></a>}</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a>advs &lt;-<span class="st"> </span>advs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AVALCA1N =</span> <span class="kw">format_avalcat1n</span>(<span class="dt">param =</span> PARAMCD, <span class="dt">aval =</span> AVAL)) <span class="op">%&gt;%</span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="st">  </span><span class="kw">left_join</span>(avalcat_lookup, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;PARAMCD&quot;</span>, <span class="st">&quot;AVALCA1N&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="right">AVALCA1N</th>
<th align="left">AVALCAT1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">HEIGHT</td>
<td align="right">147.32</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">HEIGHT</td>
<td align="right">162.56</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
<tr class="odd">
<td align="left">01-703-1086</td>
<td align="left">HEIGHT</td>
<td align="right">195.58</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
<tr class="even">
<td align="left">01-703-1096</td>
<td align="left">HEIGHT</td>
<td align="right">160.02</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
<tr class="odd">
<td align="left">01-707-1037</td>
<td align="left">HEIGHT</td>
<td align="right">152.40</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
<tr class="even">
<td align="left">01-716-1024</td>
<td align="left">HEIGHT</td>
<td align="right">154.94</td>
<td align="right">1</td>
<td align="left">&gt;140 cm</td>
</tr>
</tbody>
</table>
</div>
<div id="adsl_vars" class="section level2">
<h2>Add ADSL variables</h2>
<p>If needed, the other <code>ADSL</code> variables can now be added. List of ADSL variables already merged held in vector <code>adsl_vars</code></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>advs &lt;-<span class="st"> </span>advs <span class="op">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="kw">select</span>(adsl, <span class="op">!!!</span>admiral<span class="op">:::</span><span class="kw">negate_vars</span>(adsl_vars)),</span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;STUDYID&quot;</span>, <span class="st">&quot;USUBJID&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a>  )</span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">#&gt; Warning: Column `STUDYID` has different attributes on LHS and RHS of join</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co">#&gt; Warning: Column `USUBJID` has different attributes on LHS and RHS of join</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">RFSTDTC</th>
<th align="left">RFENDTC</th>
<th align="left">DTHDTC</th>
<th align="left">DTHFL</th>
<th align="right">AGE</th>
<th align="left">AGEU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">2014-01-02</td>
<td align="left">2014-07-02</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">63</td>
<td align="left">YEARS</td>
</tr>
</tbody>
</table>
</div>
<div id="additional" class="section level2">
<h2>Derive New Rows</h2>
<p>When deriving new rows for a data frame, it is essential the programmer takes time to insert this derivation in the correct location of the code. The location will vary depending on what previous computations should be retained on the new record and what computations must be done with the new records.</p>
<div id="example-1-creating-a-new-record" class="section level3">
<h3>Example 1 (Creating a New Record):</h3>
<p>For each subject and Vital Signs parameter, add a record holding last valid observation before end of treatment. Set <code>AVISIT</code> to <code>&quot;End of Treatment&quot;</code> and assign a unique <code>AVISITN</code> value.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>advs_ex1 &lt;-<span class="st"> </span>advs <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="st">  </span><span class="kw">derive_var_extreme_flag</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>    <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, PARAMCD),</span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="dt">order =</span> <span class="kw">vars</span>(ADT, AVISITN, ATPTN, AVAL),</span>
<span id="cb30-5"><a href="#cb30-5"></a>    <span class="dt">new_var =</span> EOTFL,</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="dt">filter =</span> (<span class="dv">4</span> <span class="op">&lt;</span><span class="st"> </span>AVISITN <span class="op">&amp;</span><span class="st"> </span>AVISITN <span class="op">&lt;=</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span>ANL01FL <span class="op">==</span><span class="st"> &quot;Y&quot;</span>)</span>
<span id="cb30-8"><a href="#cb30-8"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="st">  </span><span class="kw">filter</span>(EOTFL <span class="op">==</span><span class="st"> &quot;Y&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="dt">AVISIT =</span> <span class="st">&quot;End of Treatment&quot;</span>,</span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="dt">AVISITN =</span> <span class="dv">99</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="st">  </span><span class="kw">union_all</span>(advs) <span class="op">%&gt;%</span></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>EOTFL)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">ADT</th>
<th align="right">AVISITN</th>
<th align="left">AVISIT</th>
<th align="right">ATPTN</th>
<th align="right">AVAL</th>
<th align="left">ANL01FL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">817</td>
<td align="right">64.00000</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">MAP</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">817</td>
<td align="right">88.66667</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PULSE</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">817</td>
<td align="right">52.00000</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SYSBP</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">817</td>
<td align="right">138.00000</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">TEMP</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">NA</td>
<td align="right">36.33000</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">WEIGHT</td>
<td align="left">2014-03-26</td>
<td align="right">99</td>
<td align="left">End of Treatment</td>
<td align="right">NA</td>
<td align="right">53.07000</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-02</td>
<td align="right">0</td>
<td align="left">Baseline</td>
<td align="right">817</td>
<td align="right">61.00000</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-16</td>
<td align="right">2</td>
<td align="left">Week 2</td>
<td align="right">817</td>
<td align="right">54.00000</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-01-30</td>
<td align="right">4</td>
<td align="left">Week 4</td>
<td align="right">817</td>
<td align="right">53.00000</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">2014-02-12</td>
<td align="right">6</td>
<td align="left">Week 6</td>
<td align="right">817</td>
<td align="right">60.00000</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
</div>
<div id="example-2-deriving-a-summary-record" class="section level3">
<h3>Example 2 (Deriving a Summary Record)</h3>
<p>For each subject, Vital Signs parameter, visit, and date add a record holding the average value for observations on that date. Set <code>DTYPE</code> to <code>AVERAGE</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>advs_ex2 &lt;-<span class="st"> </span><span class="kw">derive_summary_records</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  advs,</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(STUDYID, USUBJID, PARAMCD, VISITNUM, ADT),</span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="dt">analysis_var =</span> AVAL,</span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="dt">summary_fun =</span> mean,</span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(<span class="dt">DTYPE =</span> <span class="st">&quot;AVERAGE&quot;</span>)</span>
<span id="cb31-7"><a href="#cb31-7"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="right">VISITNUM</th>
<th align="left">ADT</th>
<th align="right">AVAL</th>
<th align="left">DTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BMI</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">24.871928</td>
<td align="left">AVERAGE</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BMI</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">24.871928</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BSA</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">1.486264</td>
<td align="left">AVERAGE</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BSA</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">1.486264</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">68.000000</td>
<td align="left">AVERAGE</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">64.000000</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">83.000000</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">1</td>
<td align="left">2013-12-26</td>
<td align="right">57.000000</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">2</td>
<td align="left">2013-12-31</td>
<td align="right">66.000000</td>
<td align="left">AVERAGE</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="right">2</td>
<td align="left">2013-12-31</td>
<td align="right">68.000000</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="example-3-deriving-a-new-paramcd" class="section level3">
<h3>Example 3 (Deriving a New <code>PARAMCD</code>)</h3>
<p>Use function <code>derive_derived_param()</code> to create a new <code>PARAMCD</code>. Below is an example of creating <code>Mean Arterial Pressure</code> (<code>PARAMCD = MAP2</code>) with an alternative formula.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>advs_ex3 &lt;-<span class="st"> </span><span class="kw">derive_derived_param</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  advs,</span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="dt">by_vars =</span> <span class="kw">vars</span>(USUBJID, VISIT, ATPT),</span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="dt">parameters =</span> <span class="kw">c</span>(<span class="st">&quot;SYSBP&quot;</span>, <span class="st">&quot;DIABP&quot;</span>),</span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="dt">analysis_value =</span> (AVAL.SYSBP<span class="op">-</span>AVAL.DIABP)<span class="op">/</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>AVAL.DIABP ,</span>
<span id="cb32-6"><a href="#cb32-6"></a>  <span class="dt">set_values_to =</span> <span class="kw">vars</span>(</span>
<span id="cb32-7"><a href="#cb32-7"></a>    <span class="dt">PARAMCD =</span> <span class="st">&quot;MAP2&quot;</span>,</span>
<span id="cb32-8"><a href="#cb32-8"></a>    <span class="dt">PARAM =</span> <span class="st">&quot;Mean Arterial Pressure 2 (mmHg)&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>  )</span>
<span id="cb32-10"><a href="#cb32-10"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">PARAMCD</th>
<th align="left">VISIT</th>
<th align="left">ATPT</th>
<th align="right">AVAL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">67.00000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">MAP2</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">90.33333</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">SYSBP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">137.00000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">61.00000</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">MAP2</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">83.00000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">SYSBP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 1 MINUTE</td>
<td align="right">127.00000</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">65.00000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">MAP2</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">92.00000</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">SYSBP</td>
<td align="left">AMBUL ECG PLACEMENT</td>
<td align="left">AFTER STANDING FOR 3 MINUTES</td>
<td align="right">146.00000</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">DIABP</td>
<td align="left">AMBUL ECG REMOVAL</td>
<td align="left">AFTER LYING DOWN FOR 5 MINUTES</td>
<td align="right">72.00000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="example" class="section level1">
<h1>Example Scripts</h1>
<table>
<thead>
<tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADEG</td>
<td><a href="https://github.com/pharmaverse/admiral/blob/main/inst/templates/ad_adeg.R" target="_blank">ad_adeg.R</a></td>
</tr>
<tr class="even">
<td>ADVS</td>
<td><a href="https://github.com/pharmaverse/admiral/blob/main/inst/templates/ad_advs.R" target="_blank">ad_advs.R</a></td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
