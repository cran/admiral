<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Creating an ADAB ADaM</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Creating an ADAB ADaM</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This article describes creating an Anti-Drug Antibody (ADA) ADaM
(<code>ADAB</code>). The first part of the article describes the data
staging, the second part describes the methods of computation of
parameters, the third part describes assembling the final data set into
by visit and parameter based records then adding final flags, ADSL
variables then compute ASEQ.</p>
<p>Note: CDISC does not currently have a model or implementation guide
for ADA (<code>ADAB</code>). This <code>adab.R</code> template is
currently considered <strong>experimental</strong>.</p>
<p>This example presented uses underlying <code>EX</code> and
<code>IS</code> domains where the <code>EX</code> and <code>IS</code>
domains represent data as collected and the <code>ADAB</code> ADaM is
output. For purposes of the examples, the surrogate data for ADA is
called <code>IS_ADA</code>. The <code>IS</code> domain is intended for
multiple classes of findings so a dedicated <code>IS_ADA</code> was
added to the <code>{pharmaversesdtm}</code> for ADA data.</p>
<p>This template and the sample <code>IS</code> dataset works off of
<code>IS</code> having primary Anti-Drug Antibody results
(e.g. <code>ISTESTCD = &quot;ADA_BAB&quot;</code>) and Neutralizing Antibody
(e.g. <code>ISTESTCD = &quot;ADA_NAB&quot;</code>) records present when
<code>ADA_BAB</code> has a positive finding.</p>
<p>An important aspect of this dataset is the separation of original by
visit data, adding by visit interpreted results and creation of summary
parameters. An analogy to <code>ADAB</code> structure would be
<code>ADEX</code> as it has a mix of original visit based records and
overall/summary records. These will be illustrated later in this
vignette.</p>
<p>Here are the relative time variables we will use for by visit
records. These correspond to the names in the CDISC Implementation
Guide:</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Variable Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>NFRLT</td>
<td>Nom. Rel. Time from Analyte First Dose</td>
</tr>
<tr class="even">
<td>AFRLT</td>
<td>Act. Rel. Time from Analyte First Dose</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM
format as input unless otherwise specified.</em></p>
</div>
<div id="programming-workflow" class="section level1">
<h1>Programming Workflow</h1>
<ul>
<li><a href="#readdata">Read in Source Data</a></li>
<li><a href="#firstdose">Prepare <code>EX</code>, Find First Dose and
Derive <code>AFRLT</code></a></li>
<li><a href="#basetype">Assign Periods, Phases and BASETYPE</a></li>
<li><a href="#assigned">Derive Assigned Variables</a></li>
<li><a href="#analysis">Derive Analysis Variables</a></li>
<li><a href="#parameters">Assemble into Parameter Based Dataset</a></li>
<li><a href="#adsl_vars">Add ADSL variables</a></li>
<li><a href="#attributes">Add Labels and Attributes</a></li>
</ul>
<div id="readdata" class="section level2">
<h2>Read in Source Data</h2>
<p>To start, all datasets needed for the creation of <code>ADAB</code>
should be read into the environment. Datasets needed will be
<code>IS</code>, <code>EX</code>, and <code>ADSL</code>.</p>
<p>Additional domains such as <code>VS</code> and <code>LB</code> may be
used for additional baseline variables if needed. These may come from
either the SDTM or ADaM source.</p>
<p>For the purpose of example, the CDISC Pilot SDTM and ADaM
datasets–which are included in <code>{pharmaversesdtm}</code>–are
used.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(admiral)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(pharmaversesdtm) <span class="co"># Contains example datasets from the CDISC pilot project or simulated</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># ---- Load source datasets ----</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># Use e.g. haven::read_sas to read in .sas7bdat, or other suitable functions</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># as needed and assign to the variables below.</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># For illustration purposes read in admiral test data</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Load IS, EX and ADSL from pharmaversesdtm and admiral</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>is <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>is_ada</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>ex <span class="ot">&lt;-</span> pharmaversesdtm<span class="sc">::</span>ex</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> admiral<span class="sc">::</span>admiral_adsl</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co"># When SAS datasets are imported into R using haven::read_sas(), missing</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># character values from SAS appear as &quot;&quot; characters in R, instead of appearing</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co"># as NA values. Further details can be obtained via the following link:</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co"># https://pharmaverse.github.io/admiral/cran-release/articles/admiral.html#handling-of-missing-values # nolint</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(ex)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>is <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(is)</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>adsl <span class="ot">&lt;-</span> <span class="fu">convert_blanks_to_na</span>(adsl)</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co"># Define values for records with overall values</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co"># Suggested are AVISIT=Overall, AVISITN=11111</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>overall_avisit <span class="ot">&lt;-</span> <span class="st">&quot;OVERALL&quot;</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>overall_avisitn <span class="ot">&lt;-</span> <span class="dv">11111</span></span></code></pre></div>
<p>At this step, we first adjust for whether our source data is
<code>IS</code> using SDTM v2.0 standards or from pre-SDTM v1.8. Version
2.0 replaced <code>ISTESTCD</code> and <code>ISTEST</code> with general
ADA categories. For example, values stored (in pre-version 1.8) in
<code>ISTESTCD</code> or <code>ISTEST</code> might now be found in
<code>IS.ISBDAGNT</code>. This template provides a mechanism to process
either version, see below comments for usage.</p>
<p>If your <code>IS</code> dataset has different values in
<code>ISTESTCD</code> and <code>ISTEST</code> than the example (or has
additional tests suitable for the <code>ADAB</code> domain), adjust this
step accordingly.</p>
<p><code>ADAPARM</code> and <code>ADATYPE</code> are assigned to ensure
consistent merge variables as values are calculated in the event
<code>IS</code> data from pre-version 2.0 are used.
<code>IS.ISTESTCD</code>, and <code>IS.ISBDAGNT</code> from version 2.0
could be substituted if desired.</p>
<p><code>DRUG</code> (similar to <code>ADPC.DRUG</code>) is an assigned
variable so <code>IS</code> analytes can be merged by matching
<code>EX.EXTRT</code> value(s) for purpose of computing reference dose
and time from first dose.</p>
<p>Common variables as such <code>AVISIT</code>, <code>AVISITN</code>,
<code>FRLTU</code> are assigned.</p>
<p>Compute <code>NFRLT</code> using <code>derive_var_nfrlt()</code> to
add nominal time from first dose. A common source is
<code>IS.VISITDY</code>. <code>IS.VISIT</code> information can also be
parsed for timing values or to assign values for special visits
(i.e. “Treatment Discontinuation”, “Unscheduled”). The below code has
examples to assign special visits from <code>IS.VISIT</code>.</p>
<p>We use <code>derive_vars_merged()</code> to merge
<code>ADSL.TRTSDT</code> and compute <code>ADY</code>. <code>ADY</code>
is assumed to be based on the <code>ADSL.TRTSDT</code> while
<code>ADAB.AFRLT</code> is based on the matching <code>EX.EXTRT</code>
for the corresponding <code>IS</code> analytes.</p>
<p>If <code>IS.ISDTC</code> is missing the time part, “00:00” is used
for the imputation. Individual companies and studies may have custom
imputation methods. If this is the case, the function
<code>derive_vars_dtm()</code> would be either replaced or
post-processed to get the desired imputed time part. For example, a
method might be to use the time part from <code>EX.EXSTDTC</code>
(matched by the <code>IS</code> and <code>EX</code> date parts), then
the <code>IS.ISDTC</code> time is adjusted for pre-dose sampling planned
time. User would add custom code for this.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Derivations ----</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>is_dates <span class="ot">&lt;-</span> is <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="co"># Filter as needed (i.e. exclude ISSTAT has &quot;NOT DONE&quot;)</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ISSTAT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;NOT DONE&quot;</span>)) <span class="sc">&amp;</span> <span class="fu">toupper</span>(ISBDAGNT) <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="co"># Initial preparation and core variables</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="co"># ADATYPE and ADAPARM are assigned values to serve BY analyte processing</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="co"># Uncomment if Setting ADATYPE based on SDTM V1.x ISTESTCD</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="co"># ADATYPE = case_when(</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="co">#   toupper(ISTESTCD) == &quot;ADATEST1&quot; ~ &quot;ADA_BAB&quot;,</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    <span class="co">#   toupper(ISTESTCD) == &quot;NABTEST1&quot; ~ &quot;ADA_NAB&quot;,</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="co">#   TRUE ~ NA_character_</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    <span class="co"># ),</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="co"># Uncomment if Setting ADAPARM based on SDTM V1.x ISTESTCD</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="co"># ADAPARM = ISTESTCD,</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    <span class="co"># Setting ADATYPE based on SDTM V2.x ISTESTCD (assumed to have ADA_BAB, ADA_NAB)</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    <span class="co"># Remove or comment out if not &gt;= SDTM V2.x</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>    <span class="at">ADATYPE =</span> ISTESTCD,</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    <span class="co"># Setting ADAPARM based on SDTM V2.x ISBDAGNT</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="co"># Remove or comment out if not &gt;= SDTM V2.x</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>    <span class="at">ADAPARM =</span> ISBDAGNT,</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>    <span class="co"># When SDTM V1.x, Setting ISBDAGNT from ISTESTCD to work with template</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>    <span class="co"># ISBDAGNT = ISTESTCD,</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    <span class="co"># Map the analyte test to corresponding DRUG in on EX.EXTRT</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>    <span class="co"># This is especially critical when multiple analytes and EX.EXTRT instances</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>    <span class="at">DRUG =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>      <span class="fu">toupper</span>(ADAPARM) <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span> <span class="sc">~</span> <span class="st">&quot;XANOMELINE&quot;</span>,</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>      <span class="fu">toupper</span>(ADAPARM) <span class="sc">==</span> <span class="st">&quot;OTHER_DRUG&quot;</span> <span class="sc">~</span> <span class="st">&quot;OTHER_DRUG&quot;</span>,</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>    ),</span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>    <span class="co"># Set AVISIT and AVISITN based on VISIT and VISITNUM</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>    <span class="at">AVISIT =</span> VISIT,</span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>    <span class="at">AVISITN =</span> VISITNUM</span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>  <span class="co"># Assign nominal time to NFRLT in DAYS</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>  <span class="co"># Special visits can be set to NA then can add more code to assign custom values</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>  <span class="co">#   (i.e. UNSCHEDULED to 99999, etc.)</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>  <span class="fu">derive_var_nfrlt</span>(</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>    <span class="at">new_var =</span> NFRLT,</span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>    <span class="at">new_var_unit =</span> FRLTU,</span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>    <span class="at">out_unit =</span> <span class="st">&quot;DAYS&quot;</span>,</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    <span class="at">tpt_var =</span> ISTPT,</span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>    <span class="at">visit_day =</span> VISITDY,</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>    <span class="at">treatment_duration =</span> <span class="dv">0</span>,</span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>    <span class="at">set_values_to_na =</span> <span class="fu">str_detect</span>(<span class="fu">toupper</span>(VISIT), <span class="st">&quot;UNSCHED&quot;</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(<span class="fu">toupper</span>(VISIT), <span class="st">&quot;TREATMENT DISC&quot;</span>)</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>    <span class="at">NFRLT =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>      <span class="fu">str_detect</span>(<span class="fu">toupper</span>(VISIT), <span class="st">&quot;TREATMENT DISC&quot;</span>) <span class="sc">~</span> <span class="dv">99997</span>,</span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>      <span class="fu">str_detect</span>(<span class="fu">toupper</span>(VISIT), <span class="st">&quot;UNSCHED&quot;</span>) <span class="sc">~</span> <span class="dv">99999</span>,</span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> NFRLT</span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>    )</span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>  <span class="co"># Join ADSL with is (need TRTSDT for ADY derivation)</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(TRTSDT),</span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a>  <span class="co"># Derive analysis date/time then compute ADY</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a>  <span class="co"># Impute missing time to 00:00:00 or as desired.</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a>  <span class="co"># Could replace this code with custom imputation code or function</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;s&quot;</span>,</span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a>    <span class="at">dtc =</span> ISDTC,</span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a>    <span class="at">ignore_seconds_flag =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a>  <span class="co"># Derive dates and times from date/times</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_dt</span>(<span class="fu">exprs</span>(ADTM)) <span class="sc">%&gt;%</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_tm</span>(<span class="fu">exprs</span>(ADTM)) <span class="sc">%&gt;%</span></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a>  <span class="fu">derive_vars_dy</span>(<span class="at">reference_date =</span> TRTSDT, <span class="at">source_vars =</span> <span class="fu">exprs</span>(ADT))</span></code></pre></div>
<table>
<colgroup>
<col width="13%" />
<col width="12%" />
<col width="9%" />
<col width="12%" />
<col width="12%" />
<col width="10%" />
<col width="22%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">ISBDAGNT</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">DRUG</th>
<th align="left">VISIT</th>
<th align="left">ADTM</th>
<th align="right">NFRLT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-01 23:30:00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-04 23:30:00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-04 23:30:00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2013-07-18 23:30:00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2013-08-01 23:30:00</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-01-06 23:30:00</td>
<td align="right">167</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-06-30 23:30:00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2014-07-15 23:30:00</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-12-17 23:30:00</td>
<td align="right">167</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-06-30 23:30:00</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="firstdose" class="section level2">
<h2>Prepare <code>EX</code>, Find First Dose and Derive AFRLT</h2>
<p>At this step, we stage the <code>EX</code> data. Filter the data as
desired to match the <code>IS</code> analyte(s). As with the
<code>IS</code> dataset staging, <code>DRUG</code> is also assigned as a
common merge variable. <code>NFRLT</code> is assigned to the
<code>EX</code> data from <code>EX.VISITDY</code> using
<code>derive_var_nfrlt()</code>. Note that <code>NFRLT</code> is not
needed for this template but added for optional usage or data
reviews.</p>
<p>Assign <code>ASTDTM</code> using <code>EX.EXSTDTC</code>. As
previously described with <code>IS.ISDTC</code>, if
<code>EX.EXSTDTC</code> is missing the time part, “00:00” is used for
the imputation. Individual companies and studies may have custom
imputation methods. If this is the case, the function
<code>derive_vars_dtm()</code> would be either replaced or
post-processed to get the desired imputed time part. For example a
method might be to use the time part from <code>IS.ISDTC</code> (matched
by the <code>IS</code> and <code>EX</code> date parts), then the
<code>EX</code> missing time is adjusted for pre-dose sampling planned
time. User would add custom code for this. <code>AENDTM</code> from
<code>EX.EXENDTC</code> is also computed in case needed. Both dates then
create date part variables using
<code>derive_vars_dtm_to_dt()</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># ---- Get dosing information ----</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>ex_dates <span class="ot">&lt;-</span> ex <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="co"># Keep applicable desired records based on EXTRT and/or dose values (&gt;=0, &gt;0, etc.)</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="fu">str_detect</span>(<span class="fu">toupper</span>(EXTRT), <span class="st">&quot;XANOMELINE&quot;</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(<span class="fu">toupper</span>(EXTRT), <span class="st">&quot;PLACEBO&quot;</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    EXDOSE <span class="sc">&gt;=</span> <span class="dv">0</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="co"># DRUG is a merge variable to map and merge ADA data with EX.EXTRT</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="co"># This will be used to merge first dose into IS working data.</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="co"># PLACEBO example is for if/when ADA was also collected on Placebo subjects</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="co"># or treatments are scrambled prior to database lock.</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="at">DRUG =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>      <span class="fu">str_detect</span>(<span class="fu">toupper</span>(EXTRT), <span class="st">&quot;XANOMELINE&quot;</span>) <span class="sc">~</span> <span class="st">&quot;XANOMELINE&quot;</span>,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>      <span class="fu">str_detect</span>(<span class="fu">toupper</span>(EXTRT), <span class="st">&quot;PLACEBO&quot;</span>) <span class="sc">~</span> <span class="st">&quot;XANOMELINE&quot;</span>,</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>      <span class="fu">str_detect</span>(<span class="fu">toupper</span>(EXTRT), <span class="st">&quot;OTHER_DRUG&quot;</span>) <span class="sc">~</span> <span class="st">&quot;OTHER_DRUG&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    )</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="co"># Assign nominal time to NFRLT in DAYS</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="fu">derive_var_nfrlt</span>(</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    <span class="at">new_var =</span> NFRLT,</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="at">new_var_unit =</span> FRLTU,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="at">out_unit =</span> <span class="st">&quot;DAYS&quot;</span>,</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="at">visit_day =</span> VISITDY,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="at">treatment_duration =</span> <span class="dv">0</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="co"># Add analysis datetime variables and set missing end date to start date</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>  <span class="co"># Impute missing time to 00:00:00 or as desired.</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    <span class="at">dtc =</span> EXSTDTC,</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AEN&quot;</span>,</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>    <span class="at">dtc =</span> EXENDTC,</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>  <span class="co"># Set missing end dates to start date or as desired</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>    <span class="at">AENDTM =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(AENDTM), ASTDTM, AENDTM)</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>  <span class="co"># Derive dates from date/times</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_dt</span>(<span class="fu">exprs</span>(ASTDTM)) <span class="sc">%&gt;%</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_dt</span>(<span class="fu">exprs</span>(AENDTM))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">EXTRT</th>
<th align="left">DRUG</th>
<th align="left">VISIT</th>
<th align="left">ASTDTM</th>
<th align="right">NFRLT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-02</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2014-01-17</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">PLACEBO</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-06-19</td>
<td align="right">167</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">PLACEBO</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-05</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">PLACEBO</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2012-08-28</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2013-07-19</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2013-08-02</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-01-07</td>
<td align="right">167</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-07-01</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2014-07-16</td>
<td align="right">13</td>
</tr>
</tbody>
</table>
<p>At this step, we use <code>derive_vars_merged()</code> to join our
prepared <code>EX</code> data into the prepared <code>IS</code> data to
compute <code>FANLDTM</code>, <code>AFRLT</code> and keep
<code>FANLTMF</code> from <code>ASTTMF</code> in case the first dose
timepart was imputed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Note: This template computes only AFRLT, see ADPC template if need EX dose expansion example.</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># Derive AFRLT in IS data</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>is_afrlt <span class="ot">&lt;-</span> is_dates <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="at">dataset_add =</span> ex_dates,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">filter_add =</span> (EXDOSE <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ASTDTM)),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">FANLDTM =</span> ASTDTM, <span class="at">FANLTMF =</span> ASTTMF),</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(ASTDTM, EXSEQ),</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">&quot;first&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, DRUG)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_dt</span>(<span class="fu">exprs</span>(FANLDTM)) <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_tm</span>(<span class="fu">exprs</span>(FANLDTM)) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="fu">derive_vars_duration</span>(</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="at">new_var =</span> AFRLT,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="at">start_date =</span> FANLDTM,</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    <span class="at">end_date =</span> ADTM,</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    <span class="at">out_unit =</span> <span class="st">&quot;DAYS&quot;</span>,</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    <span class="at">floor_in =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    <span class="at">add_one =</span> <span class="cn">FALSE</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="9%" />
<col width="7%" />
<col width="9%" />
<col width="9%" />
<col width="8%" />
<col width="18%" />
<col width="9%" />
<col width="5%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">ISBDAGNT</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">DRUG</th>
<th align="left">VISIT</th>
<th align="left">ADTM</th>
<th align="left">FANLDTM</th>
<th align="right">NFRLT</th>
<th align="right">AFRLT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-01-01 23:30:00</td>
<td align="left">2014-01-02</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-04 23:30:00</td>
<td align="left">2012-08-05</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2012-08-04 23:30:00</td>
<td align="left">2012-08-05</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2013-07-18 23:30:00</td>
<td align="left">2013-07-19</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2013-08-01 23:30:00</td>
<td align="left">2013-07-19</td>
<td align="right">13</td>
<td align="right">13.9791667</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-01-06 23:30:00</td>
<td align="left">2013-07-19</td>
<td align="right">167</td>
<td align="right">171.9791667</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-06-30 23:30:00</td>
<td align="left">2014-07-01</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="left">2014-07-15 23:30:00</td>
<td align="left">2014-07-01</td>
<td align="right">13</td>
<td align="right">14.9791667</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="left">2014-12-17 23:30:00</td>
<td align="left">2014-07-01</td>
<td align="right">167</td>
<td align="right">169.9791667</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="left">2014-06-30 23:30:00</td>
<td align="left">2014-07-01</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
</tbody>
</table>
</div>
<div id="basetype" class="section level2">
<h2>Assign Periods, Phases and BASETYPE</h2>
<p>At this step compute or assign applicable <code>APERIOD</code>,
<code>APHASE</code> and/or <code>BASETYPE</code> variables. Note: In the
<code>ADAB</code> dataset, <code>BASETYPE</code> could represent Phase
or Period but the method for assigning the <code>BASE</code> variable
for the given Phase or Period could be appended to <code>BASETYPE</code>
(i.e. “DOUBLE_BLINDED LAST”). <code>BASETYPE</code> is carried through
the remaining steps of this template as a BY variable for computing
parameters. For example, if there is a main phase and a later
maintenance phase, you might want to compute all the ADA parameters by
<code>BASETYPE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Compute or assign BASETYPE, APERIOD and APHASE ----------------------------------</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># Add study specific code as applicable using ADEX or ADSL APxx / PHw  variables</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>is_basetype <span class="ot">&lt;-</span> is_afrlt <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="at">APERIOD =</span> <span class="dv">1</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="at">APERIODC =</span> <span class="st">&quot;Period 01&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">APHASE =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="at">APHASEN =</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="at">BASETYPE =</span> <span class="st">&quot;DOUBLE_BLINDED&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  )</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="14%" />
<col width="17%" />
<col width="9%" />
<col width="13%" />
<col width="13%" />
<col width="10%" />
<col width="7%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">BASETYPE</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">DRUG</th>
<th align="left">VISIT</th>
<th align="right">NFRLT</th>
<th align="right">AFRLT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">13.9791667</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">171.9791667</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">14.9791667</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">169.9791667</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">-0.0208333</td>
</tr>
</tbody>
</table>
</div>
<div id="assigned" class="section level2">
<h2>Derive Assigned Variables</h2>
<p>At this step, we assign <code>MRT</code> (Minimum Reportable Titer)
and an optional <code>DTL</code> (Drug Tolerance Level onto the main ADA
analyte records (<code>ADATYPE == &quot;ADA_BAB&quot;</code>). Both are
sponsor/protocol specific assigned values. <code>RESULTC</code> is the
the standard interpreted character result (<code>POSITIVE</code> or
<code>NEGATIVE</code>) based values found in <code>IS.ISSTRESC</code>
(these values will be sponsor specific as applicable, starter values are
supplied to demonstrate). <code>RESULTN</code> is assigned
<code>0</code>/<code>1</code> as the numeric version of
<code>RESULTC</code>. <code>RESULTN</code> and <code>RESULTC</code> are
precursors to <code>AVAL</code> and <code>AVALC</code> and will serve as
interim variables to facilitate progression of the program and its
derivations.</p>
<p>When <code>IS.ISSTRESC</code> is “POSITIVE”, <code>IS.ISSTRESN</code>
is commonly populated with values &gt; 0. However, if
<code>ISSTRESC</code> is “POSITIVE” with a missing
<code>IS.ISSTRESN</code>, this template provides a method to assign
<code>AVAL</code> using the assigned MRT value and documents the
operation by setting <code>DTYPE = &quot;MRT&quot;</code>.</p>
<p>If your <code>IS</code> dataset has additional sponsor specific tests
kept and suitable for this template, adjust or expand variable
assignments in this step accordingly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Assign AVAL, AVALC, AVALU and DTYPE for each ISTESTCD and ISBDAGNT</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>is_aval <span class="ot">&lt;-</span> is_basetype <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">MRT =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ADAPARM <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span> <span class="sc">~</span> <span class="fl">1.4</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ADAPARM <span class="sc">==</span> <span class="st">&quot;OTHER_DRUG&quot;</span> <span class="sc">~</span> <span class="fl">9.9</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    ),</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="at">DTL =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ADAPARM <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span> <span class="sc">~</span> <span class="dv">999</span>,</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ADAPARM <span class="sc">==</span> <span class="st">&quot;OTHER_DRUG&quot;</span> <span class="sc">~</span> <span class="dv">888</span>,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    ),</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="at">RESULTC =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>      <span class="fu">toupper</span>(ISSTRESC) <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>        <span class="st">&quot;NEGATIVE&quot;</span>, <span class="st">&quot;NEGATIVE SCREEN&quot;</span>, <span class="st">&quot;NEGATIVE IMMUNODEPLETION&quot;</span>,</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        <span class="st">&quot;NEGATIVE CONFIRMATION&quot;</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">&quot;NEGATIVE&quot;</span>,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>      <span class="fu">toupper</span>(ISSTRESC) <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        <span class="st">&quot;NEGATIVE TITER&quot;</span>, <span class="st">&quot;&lt;1.70&quot;</span>, <span class="st">&quot;&lt; 1.70&quot;</span>, <span class="st">&quot;&lt;1.30&quot;</span>, <span class="st">&quot;&lt; 1.30&quot;</span>, <span class="st">&quot;&lt;1.40&quot;</span>,</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>        <span class="st">&quot;POSITIVE IMMUNODEPLETION&quot;</span>, <span class="st">&quot;POSITIVE CONFIRMATION&quot;</span>, <span class="st">&quot;POSITIVE&quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">&quot;POSITIVE&quot;</span>,</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>      ISSTRESN <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;POSITIVE&quot;</span>,</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>    ),</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>    <span class="at">RESULTN =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>      <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>      <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;NEGATIVE&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>    ),</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ISSTRESN) <span class="sc">~</span> ISSTRESN,</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ISSTRESN) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(MRT) <span class="sc">~</span> MRT,</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>    ),</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>      <span class="co"># NABSTAT gets ISSTRESC, Standard ADA is set to NA as AVAL are numeric original results</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">~</span> ISSTRESC,</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>    ),</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">~</span> ISSTRESU,</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(ISSTRESN) <span class="sc">~</span> ISSTRESU,</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ISSTRESN) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(MRT)</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">&quot;titer&quot;</span>,</span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>    ),</span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>    <span class="at">DTYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">toupper</span>(RESULTC) <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ISSTRESN) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(MRT) <span class="sc">~</span> <span class="st">&quot;MRT&quot;</span>,</span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>    )</span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="12%" />
<col width="8%" />
<col width="11%" />
<col width="9%" />
<col width="6%" />
<col width="8%" />
<col width="9%" />
<col width="5%" />
<col width="9%" />
<col width="6%" />
<col width="4%" />
<col width="4%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">VISIT</th>
<th align="right">NFRLT</th>
<th align="right">RESULTN</th>
<th align="left">RESULTC</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">AVALU</th>
<th align="right">MRT</th>
<th align="right">DTL</th>
<th align="left">DTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.51</td>
<td align="left">NA</td>
<td align="left">titer</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1023</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.48</td>
<td align="left">NA</td>
<td align="left">titer</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.40</td>
<td align="left">NA</td>
<td align="left">titer</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.57</td>
<td align="left">NA</td>
<td align="left">titer</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">BASELINE</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="analysis" class="section level2">
<h2>Derive Analysis Variables</h2>
<p>In this first section, we compute <code>ABLFL</code>,
<code>BASE</code> and <code>CHG</code>. <code>VALIDBASE</code> and
<code>VALIDPOST</code> variables are assigned to accommodate if sponsor
has restrictions to use directly or use later to qualify a record as
baseline or post-baseline as analysis variables are computed. For
example, a missing value at baseline could be considered negative while
non missing post-baseline values might required (or considered Negative
if sponsor defined as such). This example allows missing baseline but
requires post-baseline to not have missing values.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Begin computation of parameters -----------------------------------------</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># Identify Best Baseline for each analyte and parameter type</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Baseline is NFRLT &lt;= 0 or Unscheduled AND the ADA Date is on or before the date of first dose.</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>is_baseline <span class="ot">&lt;-</span> is_aval <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="co"># Calculate ABLFL. If more than one record for the &#39;order&#39; and &#39;filter&#39; will throw a duplicate</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="co"># record warning, user can decide how to adjust the mode, order, filter or adjust in prior step.</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">restrict_derivation</span>(</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="at">derivation =</span> derive_var_extreme_flag,</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM),</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>      <span class="at">order =</span> <span class="fu">exprs</span>(ADT, NFRLT),</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>      <span class="at">new_var =</span> ABLFL,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>      <span class="at">mode =</span> <span class="st">&quot;last&quot;</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    ),</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="co"># flag baseline based on time not values due to ADA parameters can in some cases permit missing.</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="co"># If special visits (i.e. &gt; 60000) are eligible as baselines, include those</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="at">filter =</span> ((NFRLT <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">|</span> NFRLT <span class="sc">&gt;</span> <span class="dv">60000</span>) <span class="sc">&amp;</span> (ADT <span class="sc">&lt;=</span> FANLDT) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(BASETYPE))</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    <span class="co"># VALID flags for use later as applicable:</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    <span class="co"># VALIDBASE flags non-missing values on baseline (by each ADATYPE and ADAPARM)</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    <span class="co">#   Note: VALIDBASE is not used as this template allows a baseline to be valid as</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="co">#        as long as its present (can be missing), adapt as needed.</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>    <span class="co"># VALIDPOST flags non-missing values on post-baseline (by each ADATYPE and ADAPARM)</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    <span class="at">VALIDBASE =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>      ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> (<span class="sc">!</span><span class="fu">is.na</span>(AVALC) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(RESULTC) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(AVAL)) <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>      ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> (<span class="fu">is.na</span>(AVALC) <span class="sc">&amp;</span> <span class="fu">is.na</span>(RESULTC) <span class="sc">&amp;</span> <span class="fu">is.na</span>(AVAL)) <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>    ),</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    <span class="at">VALIDPOST =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>      ADTM <span class="sc">&gt;</span> FANLDTM <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> (<span class="sc">!</span><span class="fu">is.na</span>(RESULTC) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(AVAL)) <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>      ADTM <span class="sc">&gt;</span> FANLDTM <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> (<span class="fu">is.na</span>(RESULTC) <span class="sc">&amp;</span> <span class="fu">is.na</span>(AVAL)) <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    )</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>  )</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co"># Compute BASE and CHG</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>is_aval_change <span class="ot">&lt;-</span> is_baseline <span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>  <span class="fu">derive_var_base</span>(</span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM),</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>    <span class="at">source_var =</span> AVAL,</span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>    <span class="at">new_var =</span> BASE,</span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>    <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>  <span class="fu">restrict_derivation</span>(</span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>    <span class="at">derivation =</span> derive_var_chg,</span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>    <span class="at">filter =</span> <span class="fu">is.na</span>(ABLFL)</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>  )</span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co"># Interpreted Result Baseline</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a>is_result_change <span class="ot">&lt;-</span> is_aval_change <span class="sc">%&gt;%</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a>  <span class="fu">derive_var_base</span>(</span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM),</span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a>    <span class="at">source_var =</span> RESULTN,</span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a>    <span class="at">new_var =</span> BASE_RESULT,</span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a>    <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a>  )</span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co"># Get base only data for use later</span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a>base_data <span class="ot">&lt;-</span> is_result_change <span class="sc">%&gt;%</span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a>  <span class="fu">filter</span>(ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a>    STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE, ADAPARM, BASE_RESULT, BASE,</span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a>    ABLFL</span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="11%" />
<col width="7%" />
<col width="10%" />
<col width="7%" />
<col width="5%" />
<col width="7%" />
<col width="8%" />
<col width="4%" />
<col width="8%" />
<col width="5%" />
<col width="4%" />
<col width="5%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">VISIT</th>
<th align="right">NFRLT</th>
<th align="right">RESULTN</th>
<th align="left">RESULTC</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">ABLFL</th>
<th align="right">BASE</th>
<th align="right">CHG</th>
<th align="right">BASE_RESULT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.40</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.48</td>
<td align="right">-0.08</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.57</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.48</td>
<td align="right">0.09</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1133</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.54</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.40</td>
<td align="right">0.14</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">01-701-1133</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">1</td>
<td align="left">POSITIVE</td>
<td align="right">1.52</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1.40</td>
<td align="right">0.12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">01-701-1133</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 2</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1133</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="left">WEEK 24</td>
<td align="right">167</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>This section computes main ADA analyte parameters into a horizontal
dataset.</p>
<p>Key Subject By Visit analysis variables (sponsor or molecule specific
or optional):</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TFLAGV</code></td>
<td>By visit Treatment Emergent Category (see *T-Flags)</td>
</tr>
<tr class="even">
<td><code>PBFLAGV</code></td>
<td>Post-Baseline Status by Visit</td>
</tr>
<tr class="odd">
<td><code>ADASTATV</code></td>
<td>Overall ADA Status by Visit (ADA Positive or Negative)</td>
</tr>
</tbody>
</table>
<p>Key Subject Overall analysis variables:</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>BFLAG</code></td>
<td>Baseline Positive/Negative Flag</td>
</tr>
<tr class="even">
<td><code>TFLAG</code></td>
<td>Overall Treatment Emergent Category (see *T-Flags)</td>
</tr>
<tr class="odd">
<td><code>PBFLAG</code></td>
<td>Post-Baseline Status</td>
</tr>
<tr class="even">
<td><code>ADASTAT</code></td>
<td>Overall Subject ADA Status (ADA Positive or Negative)</td>
</tr>
</tbody>
</table>
<p>*T-Flags: 0 = Negative, 1 = Induced, 2 = Enhanced, 3 = Treatment
Unaffected<br />
Induced: Negative at Baseline to Positive Post-Baseline<br />
Enhanced: Positive at Baseline to Positive Post-Baseline where Change
from Baseline &gt;= 0.60<br />
Treatment Unaffected: Positive at Baseline to Positive where Change from
Baseline &lt; 0.60</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Assign and save ADABLPFL for later use</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>adablpfl <span class="ot">&lt;-</span> is_result_change <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">filter</span>(ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">distinct</span>(STUDYID, USUBJID, DRUG, BASETYPE,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    ADATYPE, ADAPARM,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="at">.keep_all =</span> <span class="cn">TRUE</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">select</span>(STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE, ADAPARM, ABLFL) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ADABLPFL =</span> ABLFL)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co"># Calculate the By Visit parameters</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>is_visit_flags <span class="ot">&lt;-</span> is_result_change <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="at">TFLAGV =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>      VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> (BASE_RESULT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (CHG <span class="sc">&gt;=</span> <span class="fl">0.6</span>))</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>      <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>      VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> BASE_RESULT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>        (((CHG <span class="sc">&lt;</span> <span class="fl">0.6</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(AVAL)) <span class="sc">|</span> (RESULTN <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>      VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ((BASE_RESULT <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>        <span class="fu">is.na</span>(BASE_RESULT)) <span class="sc">&amp;</span> RESULTN <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>      VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> ((BASE_RESULT <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>        <span class="fu">is.na</span>(BASE_RESULT)) <span class="sc">&amp;</span> RESULTN <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    ),</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>    <span class="at">PBFLAGV =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(TFLAGV) <span class="sc">&amp;</span> TFLAGV <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(TFLAGV) <span class="sc">&amp;</span> TFLAGV <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    ),</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>    <span class="at">ADASTATV =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(PBFLAGV) <span class="sc">&amp;</span> PBFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;ADA+&quot;</span>,</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(PBFLAGV) <span class="sc">&amp;</span> PBFLAGV <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;ADA-&quot;</span>,</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>      VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(PBFLAGV) <span class="sc">~</span> <span class="st">&quot;MISSING&quot;</span>,</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;MISSING&quot;</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>    ),</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>  )</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="co"># These next code segments create utility datasets that will</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="co"># then get merged back into the main dataset (is_visit_flags)</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co"># Post baseline must be valid post data (result not missing)</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>post_data <span class="ot">&lt;-</span> is_visit_flags <span class="sc">%&gt;%</span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>  <span class="fu">filter</span>(VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>    STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE, ADAPARM, RESULTN,</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>    AVAL, ADTM, CHG</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">AVAL_P =</span> AVAL) <span class="sc">%&gt;%</span></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">RESULT_P =</span> RESULTN)</span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="co"># Use &quot;post_data&quot; to make a ADPBLPFL flag data set to merge back later in the program</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="co"># Note:  &quot;post_data&quot; is if VALIDPOST=&quot;Y&quot; (has a non missing post baseline result)</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>adpblpfl <span class="ot">&lt;-</span> post_data <span class="sc">%&gt;%</span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>  <span class="fu">distinct</span>(STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE,</span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a>    ADAPARM,</span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a>    <span class="at">.keep_all =</span> <span class="cn">TRUE</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a>  <span class="fu">select</span>(STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>    <span class="at">ADPBLPFL =</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>  )</span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a><span class="co"># Compute BFLAG, TFLAG, PBFLAG ----</span></span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a>most_post_result <span class="ot">&lt;-</span> post_data <span class="sc">%&gt;%</span></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, DRUG, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">RESULT_P =</span> <span class="fu">max</span>(RESULT_P)) <span class="sc">%&gt;%</span></span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a>most_post_aval <span class="ot">&lt;-</span> post_data <span class="sc">%&gt;%</span></span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(AVAL_P)) <span class="sc">%&gt;%</span></span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">AVAL_P =</span> <span class="fu">max</span>(AVAL_P)) <span class="sc">%&gt;%</span></span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-75"><a href="#cb8-75" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" tabindex="-1"></a>most_post_chg <span class="ot">&lt;-</span> post_data <span class="sc">%&gt;%</span></span>
<span id="cb8-77"><a href="#cb8-77" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(AVAL_P)) <span class="sc">%&gt;%</span></span>
<span id="cb8-78"><a href="#cb8-78" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb8-79"><a href="#cb8-79" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">MAXCHG =</span> <span class="fu">max</span>(CHG)) <span class="sc">%&gt;%</span></span>
<span id="cb8-80"><a href="#cb8-80" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-81"><a href="#cb8-81" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" tabindex="-1"></a><span class="co"># Merge the most_post_result, most_post_aval and most_post_chg into one utility data set</span></span>
<span id="cb8-83"><a href="#cb8-83" tabindex="-1"></a>most_post <span class="ot">&lt;-</span> most_post_result <span class="sc">%&gt;%</span></span>
<span id="cb8-84"><a href="#cb8-84" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb8-85"><a href="#cb8-85" tabindex="-1"></a>    <span class="at">dataset_add =</span> most_post_aval,</span>
<span id="cb8-86"><a href="#cb8-86" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb8-87"><a href="#cb8-87" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-88"><a href="#cb8-88" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb8-89"><a href="#cb8-89" tabindex="-1"></a>    <span class="at">dataset_add =</span> most_post_chg,</span>
<span id="cb8-90"><a href="#cb8-90" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb8-91"><a href="#cb8-91" tabindex="-1"></a>  )</span>
<span id="cb8-92"><a href="#cb8-92" tabindex="-1"></a></span>
<span id="cb8-93"><a href="#cb8-93" tabindex="-1"></a><span class="co"># Use an outer Join to combine baseline with most post results create utility dataset with flag data</span></span>
<span id="cb8-94"><a href="#cb8-94" tabindex="-1"></a>flagdata_init <span class="ot">&lt;-</span> <span class="fu">full_join</span>(base_data, most_post, <span class="at">by =</span> <span class="fu">c</span>(</span>
<span id="cb8-95"><a href="#cb8-95" tabindex="-1"></a>  <span class="st">&quot;DRUG&quot;</span>, <span class="st">&quot;STUDYID&quot;</span>, <span class="st">&quot;USUBJID&quot;</span>, <span class="st">&quot;BASETYPE&quot;</span>,</span>
<span id="cb8-96"><a href="#cb8-96" tabindex="-1"></a>  <span class="st">&quot;ADATYPE&quot;</span>, <span class="st">&quot;ADAPARM&quot;</span></span>
<span id="cb8-97"><a href="#cb8-97" tabindex="-1"></a>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-98"><a href="#cb8-98" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-99"><a href="#cb8-99" tabindex="-1"></a>    <span class="at">BFLAG =</span></span>
<span id="cb8-100"><a href="#cb8-100" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb8-101"><a href="#cb8-101" tabindex="-1"></a>        BASE_RESULT <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-102"><a href="#cb8-102" tabindex="-1"></a>        BASE_RESULT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-103"><a href="#cb8-103" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-104"><a href="#cb8-104" tabindex="-1"></a>      ),</span>
<span id="cb8-105"><a href="#cb8-105" tabindex="-1"></a>    <span class="at">TFLAG =</span></span>
<span id="cb8-106"><a href="#cb8-106" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb8-107"><a href="#cb8-107" tabindex="-1"></a>        (BFLAG <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(BFLAG)) <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-108"><a href="#cb8-108" tabindex="-1"></a>        (BFLAG <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(BFLAG)) <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-109"><a href="#cb8-109" tabindex="-1"></a>        BFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (MAXCHG <span class="sc">&gt;=</span> <span class="fl">0.6</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb8-110"><a href="#cb8-110" tabindex="-1"></a>        BFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(MAXCHG) <span class="sc">&amp;</span> (MAXCHG <span class="sc">&lt;</span> <span class="fl">0.6</span>) <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb8-111"><a href="#cb8-111" tabindex="-1"></a>        BFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(MAXCHG) <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb8-112"><a href="#cb8-112" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-113"><a href="#cb8-113" tabindex="-1"></a>      ),</span>
<span id="cb8-114"><a href="#cb8-114" tabindex="-1"></a>    <span class="at">PBFLAG =</span></span>
<span id="cb8-115"><a href="#cb8-115" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb8-116"><a href="#cb8-116" tabindex="-1"></a>        ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> (TFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> TFLAG <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-117"><a href="#cb8-117" tabindex="-1"></a>        ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> (TFLAG <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> TFLAG <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-118"><a href="#cb8-118" tabindex="-1"></a>        ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-119"><a href="#cb8-119" tabindex="-1"></a>        ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-120"><a href="#cb8-120" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-121"><a href="#cb8-121" tabindex="-1"></a>      ),</span>
<span id="cb8-122"><a href="#cb8-122" tabindex="-1"></a>    <span class="at">ADASTAT =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-123"><a href="#cb8-123" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> PBFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb8-124"><a href="#cb8-124" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> PBFLAG <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb8-125"><a href="#cb8-125" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb8-126"><a href="#cb8-126" tabindex="-1"></a>    )</span>
<span id="cb8-127"><a href="#cb8-127" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="10%" />
<col width="5%" />
<col width="7%" />
<col width="8%" />
<col width="3%" />
<col width="4%" />
<col width="6%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">STUDYID</th>
<th align="left">USUBJID</th>
<th align="left">DRUG</th>
<th align="left">BASETYPE</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="right">BASE_RESULT</th>
<th align="right">BASE</th>
<th align="left">ABLFL</th>
<th align="right">RESULT_P</th>
<th align="right">AVAL_P</th>
<th align="right">MAXCHG</th>
<th align="right">BFLAG</th>
<th align="right">TFLAG</th>
<th align="right">PBFLAG</th>
<th align="right">ADASTAT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1015</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1</td>
<td align="right">1.51</td>
<td align="left">Y</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1023</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1028</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1</td>
<td align="right">1.48</td>
<td align="left">Y</td>
<td align="right">1</td>
<td align="right">1.57</td>
<td align="right">0.09</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1034</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1133</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1</td>
<td align="right">1.40</td>
<td align="left">Y</td>
<td align="right">1</td>
<td align="right">1.54</td>
<td align="right">0.14</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1133</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1442</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="right">1</td>
<td align="right">1.49</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-704-1008</td>
<td align="left">XANOMELINE</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1</td>
<td align="right">1.57</td>
<td align="left">Y</td>
<td align="right">1</td>
<td align="right">2.99</td>
<td align="right">1.42</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>In this section, we compute Neutralizing Antibody (Nab) Status
(optional and if applicable). Nab is typically obtained from samples
where the subject has a positive finding for its parent main analyte.
Reminder that ADA and Nab are drug specific. Drug ABC can have ADA and
optional Nab tests; Drug XYZ can also have the same pairs and are
processed separately.</p>
<p>The target variable for Nab is <code>NABSTAT</code> (subject Nab
Status for the the matching parent analyte) In this template, to be
<code>NABSTAT = &quot;Positive&quot; or &quot;Negative&quot;</code>, the subject has to
first be <code>ADASTAT=&quot;Positive&quot;</code> on the main parent matching
analyte. If not <code>ADASTAT = &quot;Positive&quot;</code>, <code>NABSTAT</code>
is set to either NA or “MISSING” as desired.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Get overall ADASTAT status for computing NABSTAT</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>flagdata_adastat <span class="ot">&lt;-</span> flagdata_init <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="at">dataset_add =</span> flagdata_init,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="at">filter_add =</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">ADASTAT_MAIN =</span> ADASTAT),</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, DRUG)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  )</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"># Compute NABPOSTMISS onto flag_data for NABSTAT</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>flagdata_nab <span class="ot">&lt;-</span> flagdata_adastat <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="fu">derive_var_merged_exist_flag</span>(</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="at">dataset_add =</span> is_visit_flags,</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="at">new_var =</span> NABPOSTMISS,</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="at">condition =</span> <span class="fu">is.na</span>(ABLFL) <span class="sc">&amp;</span> VALIDPOST <span class="sc">==</span> <span class="st">&quot;N&quot;</span> <span class="sc">&amp;</span> ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span>,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  )</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co"># Compute NAB Stat using both methods</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co"># Note: Option 2 added as a placekeeper starter method, adjust as needed for</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#   study specific specs.</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>flagdata_final <span class="ot">&lt;-</span> flagdata_nab <span class="sc">%&gt;%</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    <span class="co"># For Option 1, if any post baseline NAB were blank without a Positive (NABPOSTMISS = Y),</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    <span class="co"># NABSTAT = missing</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    <span class="at">nabstat_opt1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>      <span class="co"># Based on ADASTAT (EMERNEG/EMERPOS) and NAB results</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> ADASTAT_MAIN <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> ADASTAT_MAIN <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> RESULT_P <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>        (<span class="fu">is.na</span>(NABPOSTMISS) <span class="sc">|</span> NABPOSTMISS <span class="sc">==</span> <span class="st">&quot;N&quot;</span>) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>    ),</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>    <span class="at">nabstat_opt2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>      <span class="co"># Based on ADASTAT (EMERNEG/EMERPOS) Only.</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> ADASTAT_MAIN <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> ADASTAT_MAIN <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>    ),</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>  <span class="co"># Drop variables no longer needed from flag_data before merging with main ADAB</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>BASE, <span class="sc">-</span>BASE_RESULT, <span class="sc">-</span>AVAL_P, <span class="sc">-</span>RESULT_P, <span class="sc">-</span>DRUG, <span class="sc">-</span>ABLFL)</span></code></pre></div>
<table>
<colgroup>
<col width="9%" />
<col width="8%" />
<col width="10%" />
<col width="5%" />
<col width="7%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
<col width="9%" />
<col width="8%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">STUDYID</th>
<th align="left">USUBJID</th>
<th align="left">BASETYPE</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="right">MAXCHG</th>
<th align="right">BFLAG</th>
<th align="right">TFLAG</th>
<th align="right">PBFLAG</th>
<th align="right">ADASTAT</th>
<th align="right">ADASTAT_MAIN</th>
<th align="left">NABPOSTMISS</th>
<th align="right">nabstat_opt1</th>
<th align="right">nabstat_opt2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1015</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1023</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1023</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1028</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0.09</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1034</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1133</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">0.14</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1133</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CDISCPILOT01</td>
<td align="left">01-701-1442</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">CDISCPILOT01</td>
<td align="left">01-704-1008</td>
<td align="left">DOUBLE_BLINDED</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.42</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>In this section, we bring together the prior section variables then
compute the remaining variables into a final horizontal dataset by
<code>STUDYID</code>, <code>USUBJID</code>, <code>BASETYPE</code>,
<code>ADATYPE</code> (Nab or ADA), and <code>ADAPARM</code>. The subject
level variable values are repeated on each
<code>VISIT</code>/<code>ISDTC</code> by <code>BASETYPE</code>,
<code>ADATYPE</code>, <code>ADAPARM</code>.</p>
<p>The key analysis variables computed in this section are:</p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FPPDT</code></td>
<td>Date of first ADA Positive</td>
</tr>
<tr class="even">
<td><code>LPPDT</code></td>
<td>Date of Last ADA Positive</td>
</tr>
<tr class="odd">
<td><code>ADADUR</code></td>
<td>Duration of ADA (<code>LPPDT</code> - <code>FPPDT</code>)</td>
</tr>
<tr class="even">
<td><code>TIMADA</code></td>
<td>Time to ADA Positive (from date of first of dose of corresponding
drug)</td>
</tr>
<tr class="odd">
<td><code>INDUCED</code></td>
<td>Negative at Baseline to Positive Post-Baseline</td>
</tr>
<tr class="even">
<td><code>ENHANCED</code></td>
<td>Positive at Baseline to Positive Post-Baseline where
<code>CHG</code> &gt;= 0.60</td>
</tr>
<tr class="odd">
<td><code>TRANADA</code></td>
<td>Transient ADA (either of): (1) <code>INDUCED</code> and Positive at
any post-baseline (other than the last result) or (2)
<code>INDUCED</code>and multiple post baseline positive (other than the
last result) and duration between the first and last positive is &lt; 16
weeks</td>
</tr>
<tr class="even">
<td><code>PERSADA</code></td>
<td>Persistent ADA (either of): (1) <code>INDUCED</code> and Positive at
the last post-baseline result or (2) <code>INDUCED</code> and multiple
post-baseline positive (other than the last result) and duration between
the first and last positive is &gt;= 16 weeks</td>
</tr>
<tr class="odd">
<td><code>TRANADAE</code></td>
<td>Any Treatment Emergent Transient ADA (either of): (1)
<code>INDUCED</code> or <code>ENHANCED</code> and Positive at any
post-baseline (other than the last result) or (2) <code>INDUCED</code>
or <code>ENHANCED</code> and multiple post-baseline positive (other than
the last result) and duration between the first and last positive result
is &lt; 16 weeks</td>
</tr>
<tr class="even">
<td><code>PERSADAE</code></td>
<td>Any Treatment Emergent Persistent ADA (either of): (1)
<code>INDUCED</code> or <code>ENHANCED</code> and Positive at the last
post-baseline result or (2) <code>INDUCED</code> or
<code>ENHANCED</code> and multiple post-baseline positive (other than
the last result) and duration between the first and last positive is
&gt;= 16 weeks</td>
</tr>
<tr class="odd">
<td><code>ADABLPFL</code></td>
<td>Baseline ADA Evaluable - a baseline record exists
(<code>ABLFL = &quot;Y&quot;</code>)</td>
</tr>
<tr class="even">
<td><code>ADPBFPFL</code></td>
<td>Post-Baseline ADA Evaluable - At least one valid (non-missing)
post-baseline result</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Put TFLAG, BFLAG and PBFLAG and the nabstat_ variables onto the main</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co"># dataset (is_flagdata from is_visit_flags)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>is_flagdata <span class="ot">&lt;-</span> is_visit_flags <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="co"># main_aab_flagdata</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="at">dataset_add =</span> flagdata_final,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  )</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co"># Create a utility data set to compute PERSADA, TRANADA, INDUCED, ENHANCED related parameters</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>per_tran_pre <span class="ot">&lt;-</span> is_flagdata <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  <span class="fu">filter</span>(VALIDPOST <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM, ADTM, FANLDTM, FANLDT,</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>    TFLAGV, ISSEQ</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>    <span class="at">MaxADTM =</span> <span class="fu">max</span>(ADTM)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>    <span class="at">LFLAGPOS =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>      ADTM <span class="sc">==</span> MaxADTM <span class="sc">&amp;</span> (TFLAGV <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>      ADTM <span class="sc">==</span> MaxADTM <span class="sc">&amp;</span> (TFLAGV <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    )</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>  )</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co"># Keep TFLAGV = 1 or TFLAGV = 2 (Any Treatment Emergent)</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co"># Regular Induced PERSADA and TRANADA will later be based on TFLAGV = 1</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co"># TFLAGV = 2 can use for separate PERSADA/TRANADA based on Enhanced</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>per_tran_all <span class="ot">&lt;-</span> per_tran_pre <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>  <span class="fu">filter</span>(TFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> TFLAGV <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>MaxADTM, <span class="sc">-</span>ISSEQ) <span class="sc">%&gt;%</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>    <span class="at">FPPDTM =</span> <span class="fu">min</span>(ADTM),</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>    <span class="at">LPPDTM =</span> <span class="fu">max</span>(ADTM)</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>per_tran_inc_last <span class="ot">&lt;-</span> per_tran_all <span class="sc">%&gt;%</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">COUNT_INC_LAST =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>per_tran_exc_last <span class="ot">&lt;-</span> per_tran_all <span class="sc">%&gt;%</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(LFLAGPOS)) <span class="sc">%&gt;%</span></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>  <span class="fu">group_by</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM) <span class="sc">%&gt;%</span></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">COUNT_EXC_LAST =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a><span class="co"># Reduce &quot;per_tran_all&quot; to one record per by_vars using ADTM = LPPDTM to get best last records</span></span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a><span class="co">#   Then Merge in the Include Last and Exclude Last Flags</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a>per_tran_last <span class="ot">&lt;-</span> per_tran_all <span class="sc">%&gt;%</span></span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>  <span class="fu">filter</span>(ADTM <span class="sc">==</span> LPPDTM) <span class="sc">%&gt;%</span></span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a>    <span class="at">dataset_add =</span> per_tran_inc_last,</span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-62"><a href="#cb10-62" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-63"><a href="#cb10-63" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-64"><a href="#cb10-64" tabindex="-1"></a>    <span class="at">dataset_add =</span> per_tran_exc_last,</span>
<span id="cb10-65"><a href="#cb10-65" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-66"><a href="#cb10-66" tabindex="-1"></a>  )</span>
<span id="cb10-67"><a href="#cb10-67" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" tabindex="-1"></a><span class="co"># Compute final parameters</span></span>
<span id="cb10-69"><a href="#cb10-69" tabindex="-1"></a>per_tran_final <span class="ot">&lt;-</span> per_tran_last <span class="sc">%&gt;%</span></span>
<span id="cb10-70"><a href="#cb10-70" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-71"><a href="#cb10-71" tabindex="-1"></a>    <span class="at">FPPDT =</span> <span class="fu">as_date</span>(FPPDTM),</span>
<span id="cb10-72"><a href="#cb10-72" tabindex="-1"></a>    <span class="at">LPPDT =</span> <span class="fu">as_date</span>(LPPDTM),</span>
<span id="cb10-73"><a href="#cb10-73" tabindex="-1"></a>    <span class="at">ADADUR =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-74"><a href="#cb10-74" tabindex="-1"></a>      LPPDTM <span class="sc">-</span> FPPDTM <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> (<span class="sc">!</span><span class="fu">is.na</span>(LPPDTM) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FPPDTM)) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb10-75"><a href="#cb10-75" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(LPPDTM) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FPPDTM)</span>
<span id="cb10-76"><a href="#cb10-76" tabindex="-1"></a>      <span class="sc">~</span> ((<span class="fu">as.numeric</span>(<span class="fu">difftime</span>(LPPDTM, FPPDTM, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)) <span class="sc">/</span> (<span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">24</span>)) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb10-77"><a href="#cb10-77" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(LPPDT) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FPPDT)</span>
<span id="cb10-78"><a href="#cb10-78" tabindex="-1"></a>      <span class="sc">~</span> (<span class="fu">as.numeric</span>(LPPDT <span class="sc">-</span> FPPDT) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb10-79"><a href="#cb10-79" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb10-80"><a href="#cb10-80" tabindex="-1"></a>    ),</span>
<span id="cb10-81"><a href="#cb10-81" tabindex="-1"></a>    <span class="at">TIMADA =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-82"><a href="#cb10-82" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(FPPDTM) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FANLDTM) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(FPPDTM, FANLDTM, <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>)),</span>
<span id="cb10-83"><a href="#cb10-83" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(FPPDT) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FANLDT) <span class="sc">~</span> (<span class="fu">as.numeric</span>(FPPDT <span class="sc">-</span> FANLDT) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb10-84"><a href="#cb10-84" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb10-85"><a href="#cb10-85" tabindex="-1"></a>    ),</span>
<span id="cb10-86"><a href="#cb10-86" tabindex="-1"></a>    <span class="at">tdur =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-87"><a href="#cb10-87" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(LPPDTM) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FPPDTM) <span class="sc">~</span></span>
<span id="cb10-88"><a href="#cb10-88" tabindex="-1"></a>        <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(LPPDTM, FPPDTM, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)) <span class="sc">/</span> (<span class="dv">7</span> <span class="sc">*</span> <span class="dv">3600</span> <span class="sc">*</span> <span class="dv">24</span>),</span>
<span id="cb10-89"><a href="#cb10-89" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(LPPDT) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(FPPDT) <span class="sc">~</span> <span class="fu">as.numeric</span>(LPPDT <span class="sc">-</span> FPPDT <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb10-90"><a href="#cb10-90" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb10-91"><a href="#cb10-91" tabindex="-1"></a>    ),</span>
<span id="cb10-92"><a href="#cb10-92" tabindex="-1"></a>    <span class="co"># Standard TRANADA and PERSADA based on TFLAGV = 1 (Induced)</span></span>
<span id="cb10-93"><a href="#cb10-93" tabindex="-1"></a>    <span class="at">TRANADA =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-94"><a href="#cb10-94" tabindex="-1"></a>      TFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> ((COUNT_EXC_LAST <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> (COUNT_INC_LAST <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> tdur <span class="sc">&lt;</span> <span class="dv">16</span>)) <span class="sc">&amp;</span> <span class="fu">is.na</span>(LFLAGPOS)) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-95"><a href="#cb10-95" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb10-96"><a href="#cb10-96" tabindex="-1"></a>    ),</span>
<span id="cb10-97"><a href="#cb10-97" tabindex="-1"></a>    <span class="at">PERSADA =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-98"><a href="#cb10-98" tabindex="-1"></a>      TFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (COUNT_INC_LAST <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (COUNT_EXC_LAST <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT_EXC_LAST)) <span class="sc">|</span></span>
<span id="cb10-99"><a href="#cb10-99" tabindex="-1"></a>        (COUNT_INC_LAST <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> tdur <span class="sc">&gt;=</span> <span class="dv">16</span>) <span class="sc">|</span> LFLAGPOS <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-100"><a href="#cb10-100" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb10-101"><a href="#cb10-101" tabindex="-1"></a>    ),</span>
<span id="cb10-102"><a href="#cb10-102" tabindex="-1"></a>    <span class="co"># These TRANADAE and PERSADAE based on TFLAGV = 1 or TFLAGV=2 (Induced or Enhanced)</span></span>
<span id="cb10-103"><a href="#cb10-103" tabindex="-1"></a>    <span class="at">TRANADAE =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-104"><a href="#cb10-104" tabindex="-1"></a>      TFLAGV <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> ((COUNT_EXC_LAST <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> (COUNT_INC_LAST <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> tdur <span class="sc">&lt;</span> <span class="dv">16</span>)) <span class="sc">&amp;</span> <span class="fu">is.na</span>(LFLAGPOS)) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-105"><a href="#cb10-105" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb10-106"><a href="#cb10-106" tabindex="-1"></a>    ),</span>
<span id="cb10-107"><a href="#cb10-107" tabindex="-1"></a>    <span class="at">PERSADAE =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-108"><a href="#cb10-108" tabindex="-1"></a>      TFLAGV <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> (COUNT_INC_LAST <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (COUNT_EXC_LAST <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(COUNT_EXC_LAST)) <span class="sc">|</span></span>
<span id="cb10-109"><a href="#cb10-109" tabindex="-1"></a>        (COUNT_INC_LAST <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> tdur <span class="sc">&gt;=</span> <span class="dv">16</span>) <span class="sc">|</span> LFLAGPOS <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb10-110"><a href="#cb10-110" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb10-111"><a href="#cb10-111" tabindex="-1"></a>    ),</span>
<span id="cb10-112"><a href="#cb10-112" tabindex="-1"></a>    <span class="at">INDUCED =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-113"><a href="#cb10-113" tabindex="-1"></a>      TFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb10-114"><a href="#cb10-114" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span></span>
<span id="cb10-115"><a href="#cb10-115" tabindex="-1"></a>    ),</span>
<span id="cb10-116"><a href="#cb10-116" tabindex="-1"></a>    <span class="at">ENHANCED =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-117"><a href="#cb10-117" tabindex="-1"></a>      TFLAGV <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb10-118"><a href="#cb10-118" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span></span>
<span id="cb10-119"><a href="#cb10-119" tabindex="-1"></a>    )</span>
<span id="cb10-120"><a href="#cb10-120" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-121"><a href="#cb10-121" tabindex="-1"></a>  <span class="co"># Drop temporary variables that do not need to be merged into main ADAB</span></span>
<span id="cb10-122"><a href="#cb10-122" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ADTM, <span class="sc">-</span>TFLAGV, <span class="sc">-</span>FANLDTM, <span class="sc">-</span>FANLDT, <span class="sc">-</span>LFLAGPOS, <span class="sc">-</span>FPPDT, <span class="sc">-</span>LPPDT)</span>
<span id="cb10-123"><a href="#cb10-123" tabindex="-1"></a></span>
<span id="cb10-124"><a href="#cb10-124" tabindex="-1"></a><span class="co"># Put PERSADA, TRANADA, INDUCED, ENHANCED, TDUR, ADADUR onto &quot;is_flagdata&quot; as &quot;main_aab_pertran&quot;</span></span>
<span id="cb10-125"><a href="#cb10-125" tabindex="-1"></a><span class="co"># Note: signal_duplicate_records() error usually occurs when a subject has duplicate</span></span>
<span id="cb10-126"><a href="#cb10-126" tabindex="-1"></a><span class="co"># records for a given BASETYPE, ADATYPE, ADAPARM and ISDTC. Investigate then add code</span></span>
<span id="cb10-127"><a href="#cb10-127" tabindex="-1"></a><span class="co"># to filter it down to best one record per USUBJID, BASETYPE, ADATYPE and ADAPARM</span></span>
<span id="cb10-128"><a href="#cb10-128" tabindex="-1"></a>main_aab_pertran <span class="ot">&lt;-</span> is_flagdata <span class="sc">%&gt;%</span></span>
<span id="cb10-129"><a href="#cb10-129" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-130"><a href="#cb10-130" tabindex="-1"></a>    <span class="at">dataset_add =</span> per_tran_final,</span>
<span id="cb10-131"><a href="#cb10-131" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-132"><a href="#cb10-132" tabindex="-1"></a>  )</span>
<span id="cb10-133"><a href="#cb10-133" tabindex="-1"></a></span>
<span id="cb10-134"><a href="#cb10-134" tabindex="-1"></a>main_aab_rtimes <span class="ot">&lt;-</span> main_aab_pertran <span class="sc">%&gt;%</span></span>
<span id="cb10-135"><a href="#cb10-135" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-136"><a href="#cb10-136" tabindex="-1"></a>    <span class="at">ATPT =</span> ISTPT,</span>
<span id="cb10-137"><a href="#cb10-137" tabindex="-1"></a>    <span class="at">ADADUR =</span> <span class="fu">round</span>(ADADUR, <span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb10-138"><a href="#cb10-138" tabindex="-1"></a>    <span class="at">TIMADA =</span> <span class="fu">round</span>(TIMADA, <span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb10-139"><a href="#cb10-139" tabindex="-1"></a>    <span class="at">PERSADA =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-140"><a href="#cb10-140" tabindex="-1"></a>      <span class="fu">is.na</span>(PERSADA) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb10-141"><a href="#cb10-141" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PERSADA</span>
<span id="cb10-142"><a href="#cb10-142" tabindex="-1"></a>    ),</span>
<span id="cb10-143"><a href="#cb10-143" tabindex="-1"></a>    <span class="at">PERSADAE =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-144"><a href="#cb10-144" tabindex="-1"></a>      <span class="fu">is.na</span>(PERSADAE) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb10-145"><a href="#cb10-145" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PERSADAE</span>
<span id="cb10-146"><a href="#cb10-146" tabindex="-1"></a>    ),</span>
<span id="cb10-147"><a href="#cb10-147" tabindex="-1"></a>    <span class="at">TRANADA =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-148"><a href="#cb10-148" tabindex="-1"></a>      <span class="fu">is.na</span>(TRANADA) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb10-149"><a href="#cb10-149" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> TRANADA</span>
<span id="cb10-150"><a href="#cb10-150" tabindex="-1"></a>    ),</span>
<span id="cb10-151"><a href="#cb10-151" tabindex="-1"></a>    <span class="at">TRANADAE =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-152"><a href="#cb10-152" tabindex="-1"></a>      <span class="fu">is.na</span>(TRANADAE) <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb10-153"><a href="#cb10-153" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> TRANADAE</span>
<span id="cb10-154"><a href="#cb10-154" tabindex="-1"></a>    ),</span>
<span id="cb10-155"><a href="#cb10-155" tabindex="-1"></a>    <span class="at">NABSTAT =</span> nabstat_opt1</span>
<span id="cb10-156"><a href="#cb10-156" tabindex="-1"></a>  )</span>
<span id="cb10-157"><a href="#cb10-157" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" tabindex="-1"></a><span class="co"># Merge ADABLPFL and ADPBLPFL onto main dataset.</span></span>
<span id="cb10-159"><a href="#cb10-159" tabindex="-1"></a>main_aab <span class="ot">&lt;-</span> main_aab_rtimes <span class="sc">%&gt;%</span></span>
<span id="cb10-160"><a href="#cb10-160" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-161"><a href="#cb10-161" tabindex="-1"></a>    <span class="at">dataset_add =</span> adablpfl,</span>
<span id="cb10-162"><a href="#cb10-162" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(ADABLPFL),</span>
<span id="cb10-163"><a href="#cb10-163" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-164"><a href="#cb10-164" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-165"><a href="#cb10-165" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb10-166"><a href="#cb10-166" tabindex="-1"></a>    <span class="at">dataset_add =</span> adpblpfl,</span>
<span id="cb10-167"><a href="#cb10-167" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(ADPBLPFL),</span>
<span id="cb10-168"><a href="#cb10-168" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM)</span>
<span id="cb10-169"><a href="#cb10-169" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="4%" />
<col width="4%" />
<col width="2%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="right">MRT</th>
<th align="right">DTL</th>
<th align="left">ABLFL</th>
<th align="left">ADABLPFL</th>
<th align="left">ADPBLPFL</th>
<th align="right">NFRLT</th>
<th align="right">AFRLT</th>
<th align="left">RESULTC</th>
<th align="right">RESULTN</th>
<th align="left">ISSTRESC</th>
<th align="right">ISSTRESN</th>
<th align="left">AVALC</th>
<th align="right">AVAL</th>
<th align="left">AVALU</th>
<th align="right">BASE</th>
<th align="right">BFLAG</th>
<th align="right">TFLAG</th>
<th align="right">PBFLAG</th>
<th align="right">ADASTAT</th>
<th align="right">ADASTAT_MAIN</th>
<th align="right">NABSTAT</th>
<th align="right">ADADUR</th>
<th align="right">TIMADA</th>
<th align="right">TRANADA</th>
<th align="right">PERSADA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">13</td>
<td align="right">13.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">167</td>
<td align="right">171.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">13</td>
<td align="right">14.97917</td>
<td align="left">POSITIVE</td>
<td align="right">1</td>
<td align="left">1.4</td>
<td align="right">1.40</td>
<td align="left">NA</td>
<td align="right">1.40</td>
<td align="left">titer</td>
<td align="right">1.48</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">167</td>
<td align="right">169.97917</td>
<td align="left">POSITIVE</td>
<td align="right">1</td>
<td align="left">1.57</td>
<td align="right">1.57</td>
<td align="left">NA</td>
<td align="right">1.57</td>
<td align="left">titer</td>
<td align="right">1.48</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">13</td>
<td align="right">14.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">167</td>
<td align="right">169.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1133</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">13</td>
<td align="right">15.97917</td>
<td align="left">POSITIVE</td>
<td align="right">1</td>
<td align="left">1.54</td>
<td align="right">1.54</td>
<td align="left">NA</td>
<td align="right">1.54</td>
<td align="left">titer</td>
<td align="right">1.40</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1133</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="right">1.4</td>
<td align="right">999</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">167</td>
<td align="right">172.97917</td>
<td align="left">POSITIVE</td>
<td align="right">1</td>
<td align="left">1.52</td>
<td align="right">1.52</td>
<td align="left">NA</td>
<td align="right">1.52</td>
<td align="left">titer</td>
<td align="right">1.40</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1133</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">13</td>
<td align="right">15.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1133</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_NAB</td>
<td align="left">XANOMELINE</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="right">167</td>
<td align="right">172.97917</td>
<td align="left">NEGATIVE</td>
<td align="right">0</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NEGATIVE</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="parameters" class="section level2">
<h2>Assemble into Parameter Based Dataset</h2>
<p>In this section, we turn original <code>IS</code> records, the
duplicated interpreted records plus each analysis variable into separate
prepared data frames. These will then be appended together into the
final ADAB product.</p>
<p>Certain computed variables are limited to only by visit records or
for the main analyte. These are noted in comments if as applicable.</p>
<p>If your <code>IS</code> dataset has additional sponsor specific tests
that were added into the preceding code segments, add additional
parameter data frames here to ultimately include in the final
<code>ADAB</code> dataset.</p>
<p>On the records where the parameter is OVERALL, we also keep:
<code>PARCAT1</code>, <code>BASETYPE</code>, <code>PARAM</code>,
<code>ADATYPE</code>, <code>ADAPARM</code>, <code>ISTESTCD</code>,
<code>ISTEST</code>, <code>ISCAT</code>, <code>ISBDAGNT</code>,
<code>AVISITN</code>, <code>AVISIT</code> and <code>ISSPEC</code>. Note:
<code>ADATYPE</code>, <code>ADAPARM</code> and other interim variables
computed earlier are not kept in the final ADAB dataset. If a parameter
has unique keeps or drops, they are noted below as comments.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Begin Creation of each PARAM for the final ADAB format using main_aab --------</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#  First create &quot;core_aab&quot; with PARCAT1 to be the input for all the parameter sub-assemblies</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>core_aab <span class="ot">&lt;-</span> main_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="co"># SDTM V1.x: Assign PARAM from ISTEST or customize</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="at">PARCAT1 =</span> ISTEST,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="co"># SDTM V2.x: Assign PARAM using text values plus ADAPARM</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="at">PARCAT1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Anti-&quot;</span>, ADAPARM, <span class="st">&quot; Antibody&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>      ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Anti-&quot;</span>, ADAPARM, <span class="st">&quot; Neutralizing Antibody&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    ),</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="co"># Initialize PARAMCD and PARAM</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    <span class="at">PARAMCD =</span> ADAPARM,</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    <span class="at">PARAM =</span> PARCAT1</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  )</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co"># By Visit Primary ADA ISTESTCD Titer Results</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>adab_titer <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>    <span class="co"># For ADASTAT, append &quot;Titer Units&quot; to PARAM</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(PARCAT1, <span class="st">&quot;, Titer Units&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  )</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co"># By Visit NAB ISTESTCD Results</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>adab_nabvis <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  <span class="co"># These two flags, BASE and CHG are only kept on the primary ADA ISTESTCD test</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>BASE, <span class="sc">-</span>CHG, <span class="sc">-</span>ADABLPFL, <span class="sc">-</span>ADPBLPFL)</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co"># By Visit Main ADA Titer Interpreted RESULT data</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>adab_result <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;RESULTy&quot;</span>,</span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;ADA interpreted per sample result,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">toupper</span>(RESULTC),</span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;NEGATIVE&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>    ),</span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>  <span class="co"># DTYPE is only kept on the primary ISTESTCD parameter, drop then recompute final BASE and CHG</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DTYPE, <span class="sc">-</span>BASE, <span class="sc">-</span>CHG)</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a><span class="co"># Derive BASE and Calculate Change from Baseline on BAB RESULT records</span></span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>adab_result <span class="ot">&lt;-</span> adab_result <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a>  <span class="fu">derive_var_base</span>(</span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM),</span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a>    <span class="at">source_var =</span> AVAL,</span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a>    <span class="at">new_var =</span> BASE,</span>
<span id="cb11-56"><a href="#cb11-56" tabindex="-1"></a>    <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb11-57"><a href="#cb11-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-58"><a href="#cb11-58" tabindex="-1"></a>  <span class="fu">restrict_derivation</span>(</span>
<span id="cb11-59"><a href="#cb11-59" tabindex="-1"></a>    <span class="at">derivation =</span> derive_var_chg,</span>
<span id="cb11-60"><a href="#cb11-60" tabindex="-1"></a>    <span class="at">filter =</span> <span class="fu">is.na</span>(ABLFL)</span>
<span id="cb11-61"><a href="#cb11-61" tabindex="-1"></a>  )</span>
<span id="cb11-62"><a href="#cb11-62" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" tabindex="-1"></a><span class="co"># By Visit NAB Interpreted RESULT data</span></span>
<span id="cb11-64"><a href="#cb11-64" tabindex="-1"></a>adab_nabres <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-65"><a href="#cb11-65" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-67"><a href="#cb11-67" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;RESULTy&quot;</span>,</span>
<span id="cb11-68"><a href="#cb11-68" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Nab interpreted per sample result,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-69"><a href="#cb11-69" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">toupper</span>(RESULTC),</span>
<span id="cb11-70"><a href="#cb11-70" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-71"><a href="#cb11-71" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;NEGATIVE&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb11-72"><a href="#cb11-72" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-73"><a href="#cb11-73" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb11-74"><a href="#cb11-74" tabindex="-1"></a>    ),</span>
<span id="cb11-75"><a href="#cb11-75" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-76"><a href="#cb11-76" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-77"><a href="#cb11-77" tabindex="-1"></a>  <span class="co"># These two flags are only kept on the primary ADA test, drop then recompute final BASE and CHG</span></span>
<span id="cb11-78"><a href="#cb11-78" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ADABLPFL, <span class="sc">-</span>ADPBLPFL, <span class="sc">-</span>BASE, <span class="sc">-</span>CHG)</span>
<span id="cb11-79"><a href="#cb11-79" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" tabindex="-1"></a><span class="co"># Derive BASE and Calculate Change from Baseline on NAB RESULT records</span></span>
<span id="cb11-81"><a href="#cb11-81" tabindex="-1"></a>adab_nabres <span class="ot">&lt;-</span> adab_nabres <span class="sc">%&gt;%</span></span>
<span id="cb11-82"><a href="#cb11-82" tabindex="-1"></a>  <span class="fu">derive_var_base</span>(</span>
<span id="cb11-83"><a href="#cb11-83" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID, BASETYPE, ADATYPE, ADAPARM),</span>
<span id="cb11-84"><a href="#cb11-84" tabindex="-1"></a>    <span class="at">source_var =</span> AVAL,</span>
<span id="cb11-85"><a href="#cb11-85" tabindex="-1"></a>    <span class="at">new_var =</span> BASE,</span>
<span id="cb11-86"><a href="#cb11-86" tabindex="-1"></a>    <span class="at">filter =</span> ABLFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb11-87"><a href="#cb11-87" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-88"><a href="#cb11-88" tabindex="-1"></a>  <span class="fu">restrict_derivation</span>(</span>
<span id="cb11-89"><a href="#cb11-89" tabindex="-1"></a>    <span class="at">derivation =</span> derive_var_chg,</span>
<span id="cb11-90"><a href="#cb11-90" tabindex="-1"></a>    <span class="at">filter =</span> <span class="fu">is.na</span>(ABLFL)</span>
<span id="cb11-91"><a href="#cb11-91" tabindex="-1"></a>  )</span>
<span id="cb11-92"><a href="#cb11-92" tabindex="-1"></a></span>
<span id="cb11-93"><a href="#cb11-93" tabindex="-1"></a><span class="co"># By Visit Titer TFLAGV data -----------------------</span></span>
<span id="cb11-94"><a href="#cb11-94" tabindex="-1"></a></span>
<span id="cb11-95"><a href="#cb11-95" tabindex="-1"></a><span class="co"># Note: By Visit parameters do not keep CHG, MRT and DTL variables</span></span>
<span id="cb11-96"><a href="#cb11-96" tabindex="-1"></a>adab_tflagv <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-97"><a href="#cb11-97" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-98"><a href="#cb11-98" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-99"><a href="#cb11-99" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;TFLAGV&quot;</span>,</span>
<span id="cb11-100"><a href="#cb11-100" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment related ADA by Visit,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-101"><a href="#cb11-101" tabindex="-1"></a>    <span class="at">AVAL =</span> TFLAGV,</span>
<span id="cb11-102"><a href="#cb11-102" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">as.character</span>(AVAL),</span>
<span id="cb11-103"><a href="#cb11-103" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-104"><a href="#cb11-104" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-105"><a href="#cb11-105" tabindex="-1"></a>  <span class="co"># Drop BASE, CHG, MRT and DTL and the two --FL flags (are only kept on the primary ADA test)</span></span>
<span id="cb11-106"><a href="#cb11-106" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>BASE, <span class="sc">-</span>CHG, <span class="sc">-</span>MRT, <span class="sc">-</span>DTL, <span class="sc">-</span>ADABLPFL, <span class="sc">-</span>ADPBLPFL)</span>
<span id="cb11-107"><a href="#cb11-107" tabindex="-1"></a></span>
<span id="cb11-108"><a href="#cb11-108" tabindex="-1"></a><span class="co"># By Visit Titer PBFLAGV data ---------------------</span></span>
<span id="cb11-109"><a href="#cb11-109" tabindex="-1"></a><span class="co"># Note: By Visit parameters do not keep CHG, MRT and DTL variables</span></span>
<span id="cb11-110"><a href="#cb11-110" tabindex="-1"></a>adab_pbflagv <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-111"><a href="#cb11-111" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-112"><a href="#cb11-112" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-113"><a href="#cb11-113" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;PBFLAGV&quot;</span>,</span>
<span id="cb11-114"><a href="#cb11-114" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Post Baseline Pos/Neg by Visit,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-115"><a href="#cb11-115" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-116"><a href="#cb11-116" tabindex="-1"></a>      PBFLAGV <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> PBFLAGV <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;POSITIVE&quot;</span>,</span>
<span id="cb11-117"><a href="#cb11-117" tabindex="-1"></a>      PBFLAGV <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> PBFLAGV <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;NEGATIVE&quot;</span>,</span>
<span id="cb11-118"><a href="#cb11-118" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;MISSING&quot;</span></span>
<span id="cb11-119"><a href="#cb11-119" tabindex="-1"></a>    ),</span>
<span id="cb11-120"><a href="#cb11-120" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-121"><a href="#cb11-121" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;POSITIVE&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-122"><a href="#cb11-122" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;NEGATIVE&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb11-123"><a href="#cb11-123" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb11-124"><a href="#cb11-124" tabindex="-1"></a>    ),</span>
<span id="cb11-125"><a href="#cb11-125" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-126"><a href="#cb11-126" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-127"><a href="#cb11-127" tabindex="-1"></a>  <span class="co"># Drop BASE, CHG, MRT and DTL and the two --FL flags (are only kept on the primary ADA test)</span></span>
<span id="cb11-128"><a href="#cb11-128" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>BASE, <span class="sc">-</span>CHG, <span class="sc">-</span>MRT, <span class="sc">-</span>DTL, <span class="sc">-</span>ADABLPFL, <span class="sc">-</span>ADPBLPFL)</span>
<span id="cb11-129"><a href="#cb11-129" tabindex="-1"></a></span>
<span id="cb11-130"><a href="#cb11-130" tabindex="-1"></a><span class="co"># By Visit Titer ADASTATV data</span></span>
<span id="cb11-131"><a href="#cb11-131" tabindex="-1"></a><span class="co"># Note: By Visit parameters do not keep CHG, MRT and DTL variables</span></span>
<span id="cb11-132"><a href="#cb11-132" tabindex="-1"></a>adab_adastatv <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-133"><a href="#cb11-133" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-134"><a href="#cb11-134" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-135"><a href="#cb11-135" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ADASTATV&quot;</span>,</span>
<span id="cb11-136"><a href="#cb11-136" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;ADA Status of a patient by Visit,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-137"><a href="#cb11-137" tabindex="-1"></a>    <span class="at">AVALC =</span> ADASTATV,</span>
<span id="cb11-138"><a href="#cb11-138" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-139"><a href="#cb11-139" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;ADA+&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-140"><a href="#cb11-140" tabindex="-1"></a>      AVALC <span class="sc">==</span> <span class="st">&quot;ADA-&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb11-141"><a href="#cb11-141" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb11-142"><a href="#cb11-142" tabindex="-1"></a>    ),</span>
<span id="cb11-143"><a href="#cb11-143" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-144"><a href="#cb11-144" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-145"><a href="#cb11-145" tabindex="-1"></a>  <span class="co"># Drop BASE, CHG, MRT and DTL and the two --FL flags (are only kept on the primary ADA test)</span></span>
<span id="cb11-146"><a href="#cb11-146" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>BASE, <span class="sc">-</span>CHG, <span class="sc">-</span>MRT, <span class="sc">-</span>DTL, <span class="sc">-</span>ADABLPFL, <span class="sc">-</span>ADPBLPFL)</span>
<span id="cb11-147"><a href="#cb11-147" tabindex="-1"></a></span>
<span id="cb11-148"><a href="#cb11-148" tabindex="-1"></a><span class="co"># Next below are the individual params</span></span>
<span id="cb11-149"><a href="#cb11-149" tabindex="-1"></a><span class="co"># assign the AVISIT and AVISITN for individual params</span></span>
<span id="cb11-150"><a href="#cb11-150" tabindex="-1"></a></span>
<span id="cb11-151"><a href="#cb11-151" tabindex="-1"></a>core_aab <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-152"><a href="#cb11-152" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-153"><a href="#cb11-153" tabindex="-1"></a>    <span class="at">AVISIT =</span> overall_avisit,</span>
<span id="cb11-154"><a href="#cb11-154" tabindex="-1"></a>    <span class="at">AVISITN =</span> overall_avisitn</span>
<span id="cb11-155"><a href="#cb11-155" tabindex="-1"></a>  )</span>
<span id="cb11-156"><a href="#cb11-156" tabindex="-1"></a></span>
<span id="cb11-157"><a href="#cb11-157" tabindex="-1"></a><span class="co"># Get Patient flag BFLAG</span></span>
<span id="cb11-158"><a href="#cb11-158" tabindex="-1"></a>adab_bflag <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-159"><a href="#cb11-159" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-160"><a href="#cb11-160" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-161"><a href="#cb11-161" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-162"><a href="#cb11-162" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, BFLAG</span>
<span id="cb11-163"><a href="#cb11-163" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-164"><a href="#cb11-164" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-165"><a href="#cb11-165" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;BFLAGy&quot;</span>,</span>
<span id="cb11-166"><a href="#cb11-166" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Baseline Pos/Neg,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-167"><a href="#cb11-167" tabindex="-1"></a>    <span class="at">AVAL =</span> BFLAG,</span>
<span id="cb11-168"><a href="#cb11-168" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-169"><a href="#cb11-169" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-170"><a href="#cb11-170" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-171"><a href="#cb11-171" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-172"><a href="#cb11-172" tabindex="-1"></a>    ),</span>
<span id="cb11-173"><a href="#cb11-173" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-174"><a href="#cb11-174" tabindex="-1"></a>  )</span>
<span id="cb11-175"><a href="#cb11-175" tabindex="-1"></a></span>
<span id="cb11-176"><a href="#cb11-176" tabindex="-1"></a><span class="co"># Get Patient flag INDUCD</span></span>
<span id="cb11-177"><a href="#cb11-177" tabindex="-1"></a>adab_incucd <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-178"><a href="#cb11-178" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-179"><a href="#cb11-179" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-180"><a href="#cb11-180" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-181"><a href="#cb11-181" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, TFLAG</span>
<span id="cb11-182"><a href="#cb11-182" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-183"><a href="#cb11-183" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-184"><a href="#cb11-184" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;INDUCDy&quot;</span>,</span>
<span id="cb11-185"><a href="#cb11-185" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment induced ADA,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-186"><a href="#cb11-186" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-187"><a href="#cb11-187" tabindex="-1"></a>      TFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-188"><a href="#cb11-188" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-189"><a href="#cb11-189" tabindex="-1"></a>    ),</span>
<span id="cb11-190"><a href="#cb11-190" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-191"><a href="#cb11-191" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-192"><a href="#cb11-192" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-193"><a href="#cb11-193" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-194"><a href="#cb11-194" tabindex="-1"></a>    ),</span>
<span id="cb11-195"><a href="#cb11-195" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-196"><a href="#cb11-196" tabindex="-1"></a>  )</span>
<span id="cb11-197"><a href="#cb11-197" tabindex="-1"></a></span>
<span id="cb11-198"><a href="#cb11-198" tabindex="-1"></a><span class="co"># Get Patient flag ENHANC</span></span>
<span id="cb11-199"><a href="#cb11-199" tabindex="-1"></a>adab_enhanc <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-200"><a href="#cb11-200" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-201"><a href="#cb11-201" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-202"><a href="#cb11-202" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-203"><a href="#cb11-203" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, TFLAG</span>
<span id="cb11-204"><a href="#cb11-204" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-205"><a href="#cb11-205" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-206"><a href="#cb11-206" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ENHANCy&quot;</span>,</span>
<span id="cb11-207"><a href="#cb11-207" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment enhanced ADA,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-208"><a href="#cb11-208" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-209"><a href="#cb11-209" tabindex="-1"></a>      TFLAG <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-210"><a href="#cb11-210" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-211"><a href="#cb11-211" tabindex="-1"></a>    ),</span>
<span id="cb11-212"><a href="#cb11-212" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-213"><a href="#cb11-213" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-214"><a href="#cb11-214" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-215"><a href="#cb11-215" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-216"><a href="#cb11-216" tabindex="-1"></a>    ),</span>
<span id="cb11-217"><a href="#cb11-217" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-218"><a href="#cb11-218" tabindex="-1"></a>  )</span>
<span id="cb11-219"><a href="#cb11-219" tabindex="-1"></a></span>
<span id="cb11-220"><a href="#cb11-220" tabindex="-1"></a><span class="co"># Get Patient flag EMERPOS</span></span>
<span id="cb11-221"><a href="#cb11-221" tabindex="-1"></a>adab_emerpos <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-222"><a href="#cb11-222" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-223"><a href="#cb11-223" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-224"><a href="#cb11-224" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-225"><a href="#cb11-225" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, PBFLAG</span>
<span id="cb11-226"><a href="#cb11-226" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-227"><a href="#cb11-227" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-228"><a href="#cb11-228" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;EMERPOSy&quot;</span>,</span>
<span id="cb11-229"><a href="#cb11-229" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment Emergent - Positive,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-230"><a href="#cb11-230" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-231"><a href="#cb11-231" tabindex="-1"></a>      PBFLAG <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-232"><a href="#cb11-232" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-233"><a href="#cb11-233" tabindex="-1"></a>    ),</span>
<span id="cb11-234"><a href="#cb11-234" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-235"><a href="#cb11-235" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-236"><a href="#cb11-236" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-237"><a href="#cb11-237" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-238"><a href="#cb11-238" tabindex="-1"></a>    ),</span>
<span id="cb11-239"><a href="#cb11-239" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-240"><a href="#cb11-240" tabindex="-1"></a>  )</span>
<span id="cb11-241"><a href="#cb11-241" tabindex="-1"></a></span>
<span id="cb11-242"><a href="#cb11-242" tabindex="-1"></a><span class="co"># Get Patient flag TRUNAFF</span></span>
<span id="cb11-243"><a href="#cb11-243" tabindex="-1"></a>adab_trunaff <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-244"><a href="#cb11-244" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-245"><a href="#cb11-245" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-246"><a href="#cb11-246" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-247"><a href="#cb11-247" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, TFLAG</span>
<span id="cb11-248"><a href="#cb11-248" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-249"><a href="#cb11-249" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-250"><a href="#cb11-250" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;TRUNAFFy&quot;</span>,</span>
<span id="cb11-251"><a href="#cb11-251" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment unaffected,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-252"><a href="#cb11-252" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-253"><a href="#cb11-253" tabindex="-1"></a>      TFLAG <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-254"><a href="#cb11-254" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-255"><a href="#cb11-255" tabindex="-1"></a>    ),</span>
<span id="cb11-256"><a href="#cb11-256" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-257"><a href="#cb11-257" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-258"><a href="#cb11-258" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-259"><a href="#cb11-259" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-260"><a href="#cb11-260" tabindex="-1"></a>    ),</span>
<span id="cb11-261"><a href="#cb11-261" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-262"><a href="#cb11-262" tabindex="-1"></a>  )</span>
<span id="cb11-263"><a href="#cb11-263" tabindex="-1"></a></span>
<span id="cb11-264"><a href="#cb11-264" tabindex="-1"></a><span class="co"># Get Patient flag EMERNEG</span></span>
<span id="cb11-265"><a href="#cb11-265" tabindex="-1"></a>adab_emerneg <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-266"><a href="#cb11-266" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-267"><a href="#cb11-267" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-268"><a href="#cb11-268" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-269"><a href="#cb11-269" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, PBFLAG</span>
<span id="cb11-270"><a href="#cb11-270" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-271"><a href="#cb11-271" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-272"><a href="#cb11-272" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;EMERNEGy&quot;</span>,</span>
<span id="cb11-273"><a href="#cb11-273" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Treatment Emergent - Negative,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-274"><a href="#cb11-274" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-275"><a href="#cb11-275" tabindex="-1"></a>      PBFLAG <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-276"><a href="#cb11-276" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-277"><a href="#cb11-277" tabindex="-1"></a>    ),</span>
<span id="cb11-278"><a href="#cb11-278" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-279"><a href="#cb11-279" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-280"><a href="#cb11-280" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-281"><a href="#cb11-281" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-282"><a href="#cb11-282" tabindex="-1"></a>    ),</span>
<span id="cb11-283"><a href="#cb11-283" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-284"><a href="#cb11-284" tabindex="-1"></a>  )</span>
<span id="cb11-285"><a href="#cb11-285" tabindex="-1"></a></span>
<span id="cb11-286"><a href="#cb11-286" tabindex="-1"></a><span class="co"># Get Patient flag NOTRREL</span></span>
<span id="cb11-287"><a href="#cb11-287" tabindex="-1"></a>adab_notrrel <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-288"><a href="#cb11-288" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-289"><a href="#cb11-289" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-290"><a href="#cb11-290" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-291"><a href="#cb11-291" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, PBFLAG</span>
<span id="cb11-292"><a href="#cb11-292" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-293"><a href="#cb11-293" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-294"><a href="#cb11-294" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;NOTRRELy&quot;</span>,</span>
<span id="cb11-295"><a href="#cb11-295" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;No treatment related ADA,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-296"><a href="#cb11-296" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-297"><a href="#cb11-297" tabindex="-1"></a>      <span class="fu">is.na</span>(PBFLAG) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-298"><a href="#cb11-298" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-299"><a href="#cb11-299" tabindex="-1"></a>    ),</span>
<span id="cb11-300"><a href="#cb11-300" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-301"><a href="#cb11-301" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-302"><a href="#cb11-302" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-303"><a href="#cb11-303" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-304"><a href="#cb11-304" tabindex="-1"></a>    ),</span>
<span id="cb11-305"><a href="#cb11-305" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-306"><a href="#cb11-306" tabindex="-1"></a>  )</span>
<span id="cb11-307"><a href="#cb11-307" tabindex="-1"></a></span>
<span id="cb11-308"><a href="#cb11-308" tabindex="-1"></a><span class="co"># Get Patient flag ADASTAT</span></span>
<span id="cb11-309"><a href="#cb11-309" tabindex="-1"></a>adab_adastat <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-310"><a href="#cb11-310" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-311"><a href="#cb11-311" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-312"><a href="#cb11-312" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-313"><a href="#cb11-313" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, ADASTAT</span>
<span id="cb11-314"><a href="#cb11-314" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-315"><a href="#cb11-315" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-316"><a href="#cb11-316" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ADASTATy&quot;</span>,</span>
<span id="cb11-317"><a href="#cb11-317" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;ADA Status of a patient,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-318"><a href="#cb11-318" tabindex="-1"></a>    <span class="at">AVAL =</span> ADASTAT,</span>
<span id="cb11-319"><a href="#cb11-319" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-320"><a href="#cb11-320" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;POSITIVE&quot;</span>,</span>
<span id="cb11-321"><a href="#cb11-321" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;NEGATIVE&quot;</span>,</span>
<span id="cb11-322"><a href="#cb11-322" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;MISSING&quot;</span></span>
<span id="cb11-323"><a href="#cb11-323" tabindex="-1"></a>    ),</span>
<span id="cb11-324"><a href="#cb11-324" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-325"><a href="#cb11-325" tabindex="-1"></a>  )</span>
<span id="cb11-326"><a href="#cb11-326" tabindex="-1"></a></span>
<span id="cb11-327"><a href="#cb11-327" tabindex="-1"></a><span class="co"># Get Patient flag TIMADA</span></span>
<span id="cb11-328"><a href="#cb11-328" tabindex="-1"></a>adab_timada <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-329"><a href="#cb11-329" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-330"><a href="#cb11-330" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-331"><a href="#cb11-331" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-332"><a href="#cb11-332" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, TIMADA</span>
<span id="cb11-333"><a href="#cb11-333" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-334"><a href="#cb11-334" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-335"><a href="#cb11-335" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;TIMADAy&quot;</span>,</span>
<span id="cb11-336"><a href="#cb11-336" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Time to onset of ADA (Weeks),&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-337"><a href="#cb11-337" tabindex="-1"></a>    <span class="at">AVAL =</span> TIMADA,</span>
<span id="cb11-338"><a href="#cb11-338" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb11-339"><a href="#cb11-339" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(AVAL), <span class="st">&quot;WEEKS&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb11-340"><a href="#cb11-340" tabindex="-1"></a>  )</span>
<span id="cb11-341"><a href="#cb11-341" tabindex="-1"></a></span>
<span id="cb11-342"><a href="#cb11-342" tabindex="-1"></a><span class="co"># Get Patient flag PERSADA</span></span>
<span id="cb11-343"><a href="#cb11-343" tabindex="-1"></a>adab_persada <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-344"><a href="#cb11-344" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-345"><a href="#cb11-345" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-346"><a href="#cb11-346" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-347"><a href="#cb11-347" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, PERSADA</span>
<span id="cb11-348"><a href="#cb11-348" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-349"><a href="#cb11-349" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-350"><a href="#cb11-350" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;PERSADAy&quot;</span>,</span>
<span id="cb11-351"><a href="#cb11-351" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Persistent ADA,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-352"><a href="#cb11-352" tabindex="-1"></a>    <span class="at">AVAL =</span> PERSADA,</span>
<span id="cb11-353"><a href="#cb11-353" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-354"><a href="#cb11-354" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-355"><a href="#cb11-355" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-356"><a href="#cb11-356" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-357"><a href="#cb11-357" tabindex="-1"></a>    ),</span>
<span id="cb11-358"><a href="#cb11-358" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-359"><a href="#cb11-359" tabindex="-1"></a>  )</span>
<span id="cb11-360"><a href="#cb11-360" tabindex="-1"></a></span>
<span id="cb11-361"><a href="#cb11-361" tabindex="-1"></a><span class="co"># Get Patient flag TRANADA</span></span>
<span id="cb11-362"><a href="#cb11-362" tabindex="-1"></a>adab_tranada <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-363"><a href="#cb11-363" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-364"><a href="#cb11-364" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-365"><a href="#cb11-365" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-366"><a href="#cb11-366" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, TRANADA</span>
<span id="cb11-367"><a href="#cb11-367" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-368"><a href="#cb11-368" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-369"><a href="#cb11-369" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;TRANADAy&quot;</span>,</span>
<span id="cb11-370"><a href="#cb11-370" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Transient ADA,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-371"><a href="#cb11-371" tabindex="-1"></a>    <span class="at">AVAL =</span> TRANADA,</span>
<span id="cb11-372"><a href="#cb11-372" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-373"><a href="#cb11-373" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb11-374"><a href="#cb11-374" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;N&quot;</span>,</span>
<span id="cb11-375"><a href="#cb11-375" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb11-376"><a href="#cb11-376" tabindex="-1"></a>    ),</span>
<span id="cb11-377"><a href="#cb11-377" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-378"><a href="#cb11-378" tabindex="-1"></a>  )</span>
<span id="cb11-379"><a href="#cb11-379" tabindex="-1"></a></span>
<span id="cb11-380"><a href="#cb11-380" tabindex="-1"></a><span class="co"># Get Patient flag NABSTAT</span></span>
<span id="cb11-381"><a href="#cb11-381" tabindex="-1"></a>adab_nabstat <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-382"><a href="#cb11-382" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-383"><a href="#cb11-383" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-384"><a href="#cb11-384" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-385"><a href="#cb11-385" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, NABSTAT</span>
<span id="cb11-386"><a href="#cb11-386" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-387"><a href="#cb11-387" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-388"><a href="#cb11-388" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;NABSTATy&quot;</span>,</span>
<span id="cb11-389"><a href="#cb11-389" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Nab Status,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-390"><a href="#cb11-390" tabindex="-1"></a>    <span class="at">AVAL =</span> NABSTAT,</span>
<span id="cb11-391"><a href="#cb11-391" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-392"><a href="#cb11-392" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;POSITIVE&quot;</span>,</span>
<span id="cb11-393"><a href="#cb11-393" tabindex="-1"></a>      AVAL <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;NEGATIVE&quot;</span>,</span>
<span id="cb11-394"><a href="#cb11-394" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;MISSING&quot;</span></span>
<span id="cb11-395"><a href="#cb11-395" tabindex="-1"></a>    ),</span>
<span id="cb11-396"><a href="#cb11-396" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-397"><a href="#cb11-397" tabindex="-1"></a>  )</span>
<span id="cb11-398"><a href="#cb11-398" tabindex="-1"></a></span>
<span id="cb11-399"><a href="#cb11-399" tabindex="-1"></a><span class="co"># Get Patient flag ADADUR</span></span>
<span id="cb11-400"><a href="#cb11-400" tabindex="-1"></a>adab_adadur <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-401"><a href="#cb11-401" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-402"><a href="#cb11-402" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-403"><a href="#cb11-403" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-404"><a href="#cb11-404" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, ADADUR</span>
<span id="cb11-405"><a href="#cb11-405" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-406"><a href="#cb11-406" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-407"><a href="#cb11-407" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;ADADURy&quot;</span>,</span>
<span id="cb11-408"><a href="#cb11-408" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;ADA Duration (Weeks),&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-409"><a href="#cb11-409" tabindex="-1"></a>    <span class="at">AVAL =</span> ADADUR,</span>
<span id="cb11-410"><a href="#cb11-410" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb11-411"><a href="#cb11-411" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(AVAL), <span class="st">&quot;WEEKS&quot;</span>, <span class="cn">NA_character_</span>)</span>
<span id="cb11-412"><a href="#cb11-412" tabindex="-1"></a>  )</span>
<span id="cb11-413"><a href="#cb11-413" tabindex="-1"></a></span>
<span id="cb11-414"><a href="#cb11-414" tabindex="-1"></a><span class="co"># Get Patient flag FPPDTM</span></span>
<span id="cb11-415"><a href="#cb11-415" tabindex="-1"></a>adab_fppdtm <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-416"><a href="#cb11-416" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-417"><a href="#cb11-417" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-418"><a href="#cb11-418" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-419"><a href="#cb11-419" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, FPPDTM</span>
<span id="cb11-420"><a href="#cb11-420" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-421"><a href="#cb11-421" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-422"><a href="#cb11-422" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;FPPDTMy&quot;</span>,</span>
<span id="cb11-423"><a href="#cb11-423" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;First Post Dose Positive Datetime,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-424"><a href="#cb11-424" tabindex="-1"></a>    <span class="at">AVAL =</span> (<span class="fu">as.numeric</span>(FPPDTM)),</span>
<span id="cb11-425"><a href="#cb11-425" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(FPPDTM), <span class="cn">NA_character_</span>,</span>
<span id="cb11-426"><a href="#cb11-426" tabindex="-1"></a>      <span class="fu">toupper</span>(<span class="fu">as.character</span>(<span class="fu">format</span>(FPPDTM, <span class="st">&quot;%d%b%Y:%H:%M:%S&quot;</span>)))</span>
<span id="cb11-427"><a href="#cb11-427" tabindex="-1"></a>    ),</span>
<span id="cb11-428"><a href="#cb11-428" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-429"><a href="#cb11-429" tabindex="-1"></a>  )</span>
<span id="cb11-430"><a href="#cb11-430" tabindex="-1"></a></span>
<span id="cb11-431"><a href="#cb11-431" tabindex="-1"></a><span class="co"># Get Patient flag LPPDTM</span></span>
<span id="cb11-432"><a href="#cb11-432" tabindex="-1"></a>adab_lppdtm <span class="ot">&lt;-</span> core_aab <span class="sc">%&gt;%</span></span>
<span id="cb11-433"><a href="#cb11-433" tabindex="-1"></a>  <span class="fu">filter</span>(ADATYPE <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-434"><a href="#cb11-434" tabindex="-1"></a>  <span class="fu">distinct</span>(</span>
<span id="cb11-435"><a href="#cb11-435" tabindex="-1"></a>    STUDYID, USUBJID, PARCAT1, BASETYPE, PARAM, ADATYPE, ADAPARM,</span>
<span id="cb11-436"><a href="#cb11-436" tabindex="-1"></a>    ISTESTCD, ISTEST, ISCAT, ISBDAGNT, AVISITN, AVISIT, ISSPEC, LPPDTM</span>
<span id="cb11-437"><a href="#cb11-437" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-438"><a href="#cb11-438" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-439"><a href="#cb11-439" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="st">&quot;LPPDTMy&quot;</span>,</span>
<span id="cb11-440"><a href="#cb11-440" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">paste</span>(<span class="st">&quot;Last Post Dose Positive Datetime,&quot;</span>, PARCAT1, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb11-441"><a href="#cb11-441" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">as.numeric</span>(LPPDTM),</span>
<span id="cb11-442"><a href="#cb11-442" tabindex="-1"></a>    <span class="at">AVALC =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(LPPDTM), <span class="cn">NA_character_</span>,</span>
<span id="cb11-443"><a href="#cb11-443" tabindex="-1"></a>      <span class="fu">toupper</span>(<span class="fu">as.character</span>(<span class="fu">format</span>(LPPDTM, <span class="st">&quot;%d%b%Y:%H:%M:%S&quot;</span>)))</span>
<span id="cb11-444"><a href="#cb11-444" tabindex="-1"></a>    ),</span>
<span id="cb11-445"><a href="#cb11-445" tabindex="-1"></a>    <span class="at">AVALU =</span> <span class="cn">NA_character_</span></span>
<span id="cb11-446"><a href="#cb11-446" tabindex="-1"></a>  )</span></code></pre></div>
<p>In this section, we set together the desired parameter data sets
created in the prior section. In this example, all are kept. A specific
study might not have Nab or need the by visit parameters
(<code>TFLAGV</code>, <code>PBFLAGV</code>, <code>ADASTATV</code>) or
need variables like <code>ADADUR</code>, <code>LPPDTM</code> and
<code>FPPDTM</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Set all the standard PARAM components together -----------------------------------</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>adab_paramcds <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  adab_titer, adab_nabvis, adab_result, adab_nabres, adab_bflag,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  adab_incucd, adab_enhanc, adab_emerpos, adab_trunaff, adab_emerneg, adab_notrrel,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  adab_adastat, adab_timada, adab_persada, adab_tranada, adab_nabstat</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co"># In this sample, also have BY VISIT parameters,</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>adab_visits <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(adab_tflagv, adab_pbflagv, adab_adastatv)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># Create the final parameterized dataset --------------------------------------------</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co"># To keep only standard parameters:</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co"># adab_study &lt;- adab_paramcds</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co"># To include BY VISIT parameters and/or others:</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>adab_study <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(adab_paramcds, adab_visits, adab_adadur, adab_fppdtm, adab_lppdtm)</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co"># Drop temporary variables and ADA Flag variables that are now parameterized, further below is a</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co"># final `select` statement to to customize the final select.</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>adab_study <span class="ot">&lt;-</span> adab_study <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    <span class="sc">-</span>TIMADA, <span class="sc">-</span>ADADUR, <span class="sc">-</span>TRANADA, <span class="sc">-</span>PERSADA, <span class="sc">-</span>TRANADAE, <span class="sc">-</span>PERSADAE, <span class="sc">-</span>INDUCED, <span class="sc">-</span>ENHANCED,</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    <span class="sc">-</span>RESULTC, <span class="sc">-</span>RESULTN, <span class="sc">-</span>ADASTAT, <span class="sc">-</span>BFLAG, <span class="sc">-</span>TFLAG, <span class="sc">-</span>PBFLAG, <span class="sc">-</span>FPPDTM, <span class="sc">-</span>LPPDTM, <span class="sc">-</span>TFLAGV, <span class="sc">-</span>PBFLAGV,</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>    <span class="sc">-</span>ADASTATV, <span class="sc">-</span>nabstat_opt1, <span class="sc">-</span>nabstat_opt2, <span class="sc">-</span>NABSTAT, <span class="sc">-</span>MAXCHG, <span class="sc">-</span>VALIDBASE, <span class="sc">-</span>VALIDPOST,</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>    <span class="sc">-</span>tdur, <span class="sc">-</span>ADASTAT_MAIN, <span class="sc">-</span>NABPOSTMISS, <span class="sc">-</span>TRTSDT</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="7%" />
<col width="7%" />
<col width="9%" />
<col width="5%" />
<col width="9%" />
<col width="34%" />
<col width="4%" />
<col width="5%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ADATYPE</th>
<th align="left">ADAPARM</th>
<th align="left">ABLFL</th>
<th align="left">PARAMCD</th>
<th align="left">PARAM</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">AVALU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1028</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">1.40</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="even">
<td align="left">01-701-1034</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">1.57</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="odd">
<td align="left">01-701-1133</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">1.54</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="even">
<td align="left">01-701-1133</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">1.52</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="odd">
<td align="left">01-701-1442</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">1.49</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="even">
<td align="left">01-701-1442</td>
<td align="left">WEEK 24</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-704-1008</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">2.99</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
<tr class="even">
<td align="left">01-704-1017</td>
<td align="left">WEEK 2</td>
<td align="left">ADA_BAB</td>
<td align="left">XANOMELINE</td>
<td align="left">NA</td>
<td align="left">XANOMELINE</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units</td>
<td align="right">2.68</td>
<td align="left">NA</td>
<td align="left">titer</td>
</tr>
</tbody>
</table>
<p>In this section, compute or merge in any additional flags or
<code>ADSL</code> variables.</p>
</div>
<div id="adsl_vars" class="section level2">
<h2>Add ADSL variables</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Merge in ADSL Values --------------------------------</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>adab_adsl <span class="ot">&lt;-</span> adab_study <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  )</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># Compute COHORT From ADSL, other source could be ADSUB</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>adab_cohort <span class="ot">&lt;-</span> adab_adsl <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">COHORT =</span> ARMCD),</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  )</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co"># Compute optional ADAFL</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co"># Method could be ADSL.SAFFL, ADAB.ADPBLPFL by ISTESTCD, etc.</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>adab_adafl <span class="ot">&lt;-</span> adab_cohort <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>    <span class="at">dataset_add =</span> adsl,</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>    <span class="at">new_vars =</span> <span class="fu">exprs</span>(<span class="at">ADAFL =</span> SAFFL),</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID)</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>  )</span></code></pre></div>
<p>In this section we create a data frame to map above
<code>PARAMCD</code> and <code>PARAM</code> to final specific values.
This step is important as we want unique
<code>PARAMCD</code>/<code>PARAM</code> values. The number suffixes
start with “1” and increment as the core parameter name is repeated.
This could be due to having <code>RESULT</code> for ADA and Nab for Drug
ABC. There could be two analytes/drug combos (<code>ISBDAGNT</code> is
“XANOMELINE” and <code>ISBDAGNT</code> is “Y012345678”).</p>
<p>After merging the <code>adab_param_data</code>, final adjustments are
made to <code>PARAMCD</code> and <code>PARAM</code> values. These
adjustments depend on whether <code>IS</code> is based on SDTM v2.0 or
an earlier version (prior to v1.8).</p>
<p>Last step is computing <code>ASEQ</code>. <code>ASEQ</code> should be
computed last since the sort key includes values in <code>PARAMCD</code>
and <code>PARAM</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Study Specific Specs Post-Processing ------------------------------------</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co"># Create a Tibble to map above PARAMCD and PARAM to final study spec values</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># Multiple NAB and ADA analytes example usage:</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># If ISTESTCD is &#39;ADA_BAB&#39; and ISBDAGNT is &#39;XANOMELINE&#39;, RESULT1, ADASTAT1, etc. PARAM_SUFFIX = &#39;(1)&#39;</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># If ISTESTCD is &#39;ADA_BAB&#39; and ISBDAGNT is &#39;Y012345678&#39;, RESULT2, ADASTAT2, etc. PARAM_SUFFIX = &#39;(2)&#39;</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># If ISTESTCD is &#39;ADA_NAB&#39; and ISBDAGNT is &#39;XANOMELINE&#39;, RESULT3, etc. PARAM_SUFFIX = &#39;(3)&#39;</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># If ISTESTCD is &#39;ADA_NAB&#39; and ISBDAGNT is &#39;Y012345678&#39;, RESULT4, etc. PARAM_SUFFIX = &#39;(4)&#39;</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>adab_param_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="sc">~</span>PARAMCD, <span class="sc">~</span>ADATYPE, <span class="sc">~</span>ADAPARM, <span class="sc">~</span>PARAMCD_NEW, <span class="sc">~</span>PARAM_SUFFIX,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ADA_NAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="st">&quot;RESULTy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;RESULT1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="st">&quot;RESULTy&quot;</span>, <span class="st">&quot;ADA_NAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;RESULT2&quot;</span>, <span class="st">&quot;(2)&quot;</span>,</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="st">&quot;BFLAGy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;BFLAG1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="st">&quot;INDUCDy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;INDUCD1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  <span class="st">&quot;ENHANCy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ENHANC1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="st">&quot;EMERPOSy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;EMERPOS1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  <span class="st">&quot;TRUNAFFy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;TRUNAFF1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="st">&quot;EMERNEGy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;EMERNEG1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>  <span class="st">&quot;NOTRRELy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;NOTRREL1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>  <span class="st">&quot;ADASTATy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ADASTAT1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>  <span class="st">&quot;TIMADAy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;TIMADA1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>  <span class="st">&quot;PERSADAy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;PERSADA1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>  <span class="st">&quot;TRANADAy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;TRANADA1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>  <span class="st">&quot;NABSTATy&quot;</span>, <span class="st">&quot;ADA_NAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;NABSTAT1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>  <span class="st">&quot;ADASTATV&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ADASTTV1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>  <span class="st">&quot;TFLAGV&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;TFLAGV1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>  <span class="st">&quot;PBFLAGV&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;PBFLAGV1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>  <span class="st">&quot;LPPDTMy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;LPPDTM1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>  <span class="st">&quot;FPPDTMy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;FPPDTM1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>  <span class="st">&quot;ADADURy&quot;</span>, <span class="st">&quot;ADA_BAB&quot;</span>, <span class="st">&quot;XANOMELINE&quot;</span>, <span class="st">&quot;ADADUR1&quot;</span>, <span class="st">&quot;(1)&quot;</span>,</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>)</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="co"># Merge the Parameter dataset into the main data</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>adab_params <span class="ot">&lt;-</span> adab_adafl <span class="sc">%&gt;%</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>  <span class="fu">derive_vars_merged</span>(</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>    <span class="at">dataset_add =</span> adab_param_data,</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(PARAMCD, ADAPARM, ADATYPE)</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>  <span class="co"># for the original data, assign PARAM</span></span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(PARAM_SUFFIX) <span class="sc">~</span> <span class="fu">paste</span>(PARAM, PARAM_SUFFIX, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PARAM</span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>    ),</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>    <span class="co"># Example to assign PARAMCD based on ADAPARM assigned at program start (SDTM.IS &lt; v2.0)</span></span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>      PARAMCD <span class="sc">==</span> ADAPARM <span class="sc">~</span> PARAMCD,</span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PARAMCD_NEW</span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>    ),</span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a>    <span class="co"># Example to assign PARAMCD based ISTESTCD type and last 5 chars of ISBDAGNT (SDTM.IS &gt;= v2.0)</span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a>    <span class="at">PARAMCD =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a>      ISTESTCD <span class="sc">==</span> <span class="st">&quot;ADA_BAB&quot;</span> <span class="sc">&amp;</span> PARAMCD <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span> <span class="sc">~</span></span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">&quot;BAB&quot;</span>, <span class="fu">substr</span>(ISBDAGNT, <span class="dv">1</span>, <span class="dv">5</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a>      ISTESTCD <span class="sc">==</span> <span class="st">&quot;ADA_NAB&quot;</span> <span class="sc">&amp;</span> PARAMCD <span class="sc">==</span> <span class="st">&quot;XANOMELINE&quot;</span> <span class="sc">~</span></span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">&quot;NAB&quot;</span>, <span class="fu">substr</span>(ISBDAGNT, <span class="dv">1</span>, <span class="dv">5</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PARAMCD</span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a>    )</span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a>  )</span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a><span class="co"># Sort by the key variables then compute ASEQ</span></span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a>adab_prefinal <span class="ot">&lt;-</span> adab_params <span class="sc">%&gt;%</span></span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a>  <span class="co"># Calculate ASEQ</span></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a>  <span class="fu">derive_var_obs_number</span>(</span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a>    <span class="at">new_var =</span> ASEQ,</span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a>    <span class="at">by_vars =</span> <span class="fu">exprs</span>(STUDYID, USUBJID),</span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">exprs</span>(PARCAT1, PARAMCD, BASETYPE, NFRLT, AFRLT, ISSEQ),</span>
<span id="cb14-70"><a href="#cb14-70" tabindex="-1"></a>    <span class="at">check_type =</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb14-71"><a href="#cb14-71" tabindex="-1"></a>  )</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="4%" />
<col width="17%" />
<col width="6%" />
<col width="44%" />
<col width="3%" />
<col width="5%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">VISIT</th>
<th align="left">ABLFL</th>
<th align="left">PARCAT1</th>
<th align="left">PARAMCD</th>
<th align="left">PARAM</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">AVALU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">ADADUR1</td>
<td align="left">ADA Duration (Weeks), Anti-XANOMELINE Antibody (1)</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">ADASTAT1</td>
<td align="left">ADA Status of a patient, Anti-XANOMELINE Antibody
(1)</td>
<td align="right">NA</td>
<td align="left">MISSING</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">Y</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">ADASTTV1</td>
<td align="left">ADA Status of a patient by Visit, Anti-XANOMELINE
Antibody (1)</td>
<td align="right">NA</td>
<td align="left">MISSING</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">BASELINE</td>
<td align="left">Y</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">BABXANOM</td>
<td align="left">Anti-XANOMELINE Antibody, Titer Units (1)</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">BFLAG1</td>
<td align="left">Baseline Pos/Neg, Anti-XANOMELINE Antibody (1)</td>
<td align="right">0</td>
<td align="left">N</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">EMERNEG1</td>
<td align="left">Treatment Emergent - Negative, Anti-XANOMELINE Antibody
(1)</td>
<td align="right">0</td>
<td align="left">N</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">EMERPOS1</td>
<td align="left">Treatment Emergent - Positive, Anti-XANOMELINE Antibody
(1)</td>
<td align="right">0</td>
<td align="left">N</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">ENHANC1</td>
<td align="left">Treatment enhanced ADA, Anti-XANOMELINE Antibody
(1)</td>
<td align="right">0</td>
<td align="left">N</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">FPPDTM1</td>
<td align="left">First Post Dose Positive Datetime, Anti-XANOMELINE
Antibody (1)</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">01-701-1015</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Anti-XANOMELINE Antibody</td>
<td align="left">INDUCD1</td>
<td align="left">Treatment induced ADA, Anti-XANOMELINE Antibody
(1)</td>
<td align="right">0</td>
<td align="left">N</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Select final variables to keep into ADAB</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Choose final variables to keep</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co"># When SDTM V1.x, suggest remove ISBDAGNT</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>adab <span class="ot">&lt;-</span> adab_prefinal <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    STUDYID, USUBJID, SUBJID, SITEID, ASEQ,</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>    REGION1, COUNTRY, ETHNIC,</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    AGE, AGEU, SEX, RACE,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    SAFFL, TRT01P, TRT01A,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    TRTSDTM, TRTSDT, TRTEDTM, TRTEDT,</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    ISSEQ, ISTESTCD, ISTEST, ISCAT, ISBDAGNT,</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    ISSTRESC, ISSTRESN, ISSTRESU,</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    ISSTAT, ISREASND, ISSPEC,</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    DTL, MRT,</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    VISITNUM, VISIT, VISITDY,</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    EPOCH, ISDTC, ISDY, ISTPT, ISTPTNUM,</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>    PARAM, PARAMCD, PARCAT1,</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>    AVAL, AVALC, AVALU,</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>    BASETYPE, BASE, CHG, DTYPE,</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>    ADTM, ADT, ADY, ATMF,</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>    AVISIT, AVISITN, ATPT,</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>    APHASE, APHASEN, APERIOD, APERIODC,</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>    FANLDTM, FANLDT, FANLTM, FANLTMF,</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>    NFRLT, AFRLT, FRLTU,</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>    ABLFL, ADABLPFL, ADPBLPFL, ADAFL</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="attributes" class="section level1">
<h1>Add Labels and Attributes</h1>
<p>Note that attributes may not be preserved in some cases after
processing with <code>{admiral}</code>. The recommended approach is to
apply variable labels and other metadata as a final step in your data
derivation process using packages like:</p>
<ul>
<li><p><a href="https://atorus-research.github.io/metacore/">metacore</a>:
establish a common foundation for the use of metadata within an R
session.</p></li>
<li><p><a href="https://pharmaverse.github.io/metatools/">metatools</a>:
enable the use of metacore objects. Metatools can be used to build
datasets or enhance columns in existing datasets as well as checking
datasets against the metadata.</p></li>
<li><p><a href="https://atorus-research.github.io/xportr/">xportr</a>:
functionality to associate all metadata information to a local R data
frame, perform data set level validation checks and convert into a <a href="https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/movefile/n1xbwdre0giahfn11c99yjkpi2yb.htm">transport
v5 file(xpt)</a>.</p></li>
</ul>
<p>NOTE: Together with <code>{admiral}</code> these packages comprise an
End to End pipeline under the umbrella of the <a href="https://github.com/pharmaverse">pharmaverse</a>. An example of
applying metadata and perform associated checks can be found at the <a href="https://pharmaverse.github.io/examples/adam/adsl">pharmaverse E2E
example</a>.</p>
</div>
<div id="example-script" class="section level1">
<h1>Example Script</h1>
<table>
<thead>
<tr class="header">
<th>ADaM</th>
<th>Sourcing Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADAB</td>
<td><code>use_ad_template(&quot;ADAB&quot;)</code></td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
